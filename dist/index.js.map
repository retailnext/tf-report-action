{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import * as https from 'https'\nimport * as fs from 'fs'\n\ninterface StepData {\n  conclusion?: string\n  outcome?: string\n  outputs?: {\n    stdout?: string\n    stderr?: string\n    exit_code?: string\n    [key: string]: unknown\n  }\n}\n\ninterface Steps {\n  [key: string]: StepData\n}\n\ninterface StepFailure {\n  name: string\n  conclusion: string\n  stdout?: string\n  stderr?: string\n  exitCode?: string\n}\n\ninterface AnalysisResult {\n  success: boolean\n  failedSteps: StepFailure[]\n  totalSteps: number\n  targetStepResult?: {\n    name: string\n    found: boolean\n    conclusion?: string\n    stdout?: string\n    stderr?: string\n    exitCode?: string\n  }\n}\n\n// GitHub comment max size is 65536 characters\nconst MAX_COMMENT_SIZE = 60000\nconst MAX_OUTPUT_PER_STEP = 20000\nconst COMMENT_TRUNCATION_BUFFER = 1000\n\n/**\n * Get an input value from the environment\n */\nexport function getInput(name: string): string {\n  const val =\n    process.env[`INPUT_${name.replace(/ /g, '_').toUpperCase()}`] || ''\n  return val.trim()\n}\n\n/**\n * Log an informational message\n */\nfunction info(message: string): void {\n  console.log(message)\n}\n\n/**\n * Set the action as failed and exit\n */\nexport function setFailed(message: string): void {\n  console.error(`::error::${message}`)\n  process.exit(1)\n}\n\nasync function httpsRequest(\n  options: https.RequestOptions,\n  data?: string\n): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const req = https.request(options, (res) => {\n      const chunks: Buffer[] = []\n      res.on('data', (chunk) => chunks.push(chunk))\n      res.on('end', () => {\n        const body = Buffer.concat(chunks).toString('utf8')\n        if (res.statusCode && res.statusCode >= 200 && res.statusCode < 300) {\n          resolve(body)\n        } else {\n          reject(new Error(`HTTP ${res.statusCode}: ${body}`))\n        }\n      })\n    })\n    req.on('error', reject)\n    if (data) {\n      req.write(data)\n    }\n    req.end()\n  })\n}\n\nasync function getExistingComments(\n  token: string,\n  repo: string,\n  owner: string,\n  issueNumber: number\n): Promise<Array<{ id: number; body: string }>> {\n  const options: https.RequestOptions = {\n    hostname: 'api.github.com',\n    path: `/repos/${owner}/${repo}/issues/${issueNumber}/comments`,\n    method: 'GET',\n    headers: {\n      Authorization: `Bearer ${token}`,\n      'User-Agent': 'tf-report-action',\n      Accept: 'application/vnd.github+json'\n    }\n  }\n\n  const response = await httpsRequest(options)\n  return JSON.parse(response)\n}\n\nasync function deleteComment(\n  token: string,\n  repo: string,\n  owner: string,\n  commentId: number\n): Promise<void> {\n  const options: https.RequestOptions = {\n    hostname: 'api.github.com',\n    path: `/repos/${owner}/${repo}/issues/comments/${commentId}`,\n    method: 'DELETE',\n    headers: {\n      Authorization: `Bearer ${token}`,\n      'User-Agent': 'tf-report-action',\n      Accept: 'application/vnd.github+json'\n    }\n  }\n\n  await httpsRequest(options)\n}\n\nasync function postComment(\n  token: string,\n  repo: string,\n  owner: string,\n  issueNumber: number,\n  body: string\n): Promise<void> {\n  const options: https.RequestOptions = {\n    hostname: 'api.github.com',\n    path: `/repos/${owner}/${repo}/issues/${issueNumber}/comments`,\n    method: 'POST',\n    headers: {\n      Authorization: `Bearer ${token}`,\n      'User-Agent': 'tf-report-action',\n      Accept: 'application/vnd.github+json',\n      'Content-Type': 'application/json'\n    }\n  }\n\n  const payload = JSON.stringify({ body })\n  await httpsRequest(options, payload)\n}\n\n/**\n * Get the GitHub job logs URL\n */\nexport function getJobLogsUrl(): string {\n  const repo = process.env.GITHUB_REPOSITORY || ''\n  const runId = process.env.GITHUB_RUN_ID || ''\n  const runAttempt = process.env.GITHUB_RUN_ATTEMPT || '1'\n\n  if (repo && runId) {\n    return `https://github.com/${repo}/actions/runs/${runId}/attempts/${runAttempt}`\n  }\n  return ''\n}\n\nexport function truncateOutput(\n  text: string,\n  maxLength: number,\n  includeLogLink = false\n): string {\n  if (text.length <= maxLength) return text\n\n  const logLink = includeLogLink ? getJobLogsUrl() : ''\n  const truncationMessage = logLink\n    ? `\\n\\n... [output truncated - [view full logs](${logLink})] ...\\n\\n`\n    : '\\n\\n... [output truncated] ...\\n\\n'\n  const availableLength = maxLength - truncationMessage.length\n\n  if (availableLength <= 0) {\n    return text.substring(0, maxLength)\n  }\n\n  const halfLength = Math.floor(availableLength / 2)\n  return (\n    text.substring(0, halfLength) +\n    truncationMessage +\n    text.substring(text.length - halfLength)\n  )\n}\n\nexport function analyzeSteps(\n  steps: Steps,\n  targetStep?: string\n): AnalysisResult {\n  const stepEntries = Object.entries(steps)\n  const totalSteps = stepEntries.length\n  const failedSteps: StepFailure[] = []\n  let targetStepResult\n\n  for (const [stepName, stepData] of stepEntries) {\n    const conclusion = stepData.conclusion || stepData.outcome || ''\n\n    // Check if this is the target step\n    if (targetStep && stepName === targetStep) {\n      targetStepResult = {\n        name: stepName,\n        found: true,\n        conclusion,\n        stdout: stepData.outputs?.stdout as string | undefined,\n        stderr: stepData.outputs?.stderr as string | undefined,\n        exitCode: stepData.outputs?.exit_code as string | undefined\n      }\n    }\n\n    // Treat as failure if not success, skipped, cancelled, or neutral\n    if (\n      conclusion &&\n      conclusion !== 'success' &&\n      conclusion !== 'skipped' &&\n      conclusion !== 'cancelled' &&\n      conclusion !== 'neutral'\n    ) {\n      const failure: StepFailure = {\n        name: stepName,\n        conclusion,\n        stdout: stepData.outputs?.stdout as string | undefined,\n        stderr: stepData.outputs?.stderr as string | undefined,\n        exitCode: stepData.outputs?.exit_code as string | undefined\n      }\n      failedSteps.push(failure)\n    }\n  }\n\n  // If target step was specified but not found\n  if (targetStep && !targetStepResult) {\n    targetStepResult = {\n      name: targetStep,\n      found: false\n    }\n  }\n\n  return {\n    success: failedSteps.length === 0,\n    failedSteps,\n    totalSteps,\n    targetStepResult\n  }\n}\n\nexport function generateCommentBody(\n  workspace: string,\n  analysis: AnalysisResult\n): string {\n  const { success, failedSteps, totalSteps, targetStepResult } = analysis\n  const marker = `<!-- tf-report-action:\"${workspace}\" -->`\n\n  let title = ''\n  let statusIcon = ''\n  let statusText = ''\n\n  if (targetStepResult) {\n    // Target step mode\n    // Show as failure if target step didn't run or overall workflow failed\n    const showAsFailure = !targetStepResult.found || !success\n\n    statusIcon = showAsFailure ? '‚ùå' : '‚úÖ'\n    statusText = showAsFailure ? 'Failed' : 'Succeeded'\n    title = `## ${statusIcon} \\`${workspace}\\` \\`${targetStepResult.name}\\` ${statusText}`\n  } else {\n    // Normal mode\n    statusIcon = success ? '‚úÖ' : '‚ùå'\n    statusText = success ? 'Succeeded' : 'Failed'\n    title = `## ${statusIcon} \\`${workspace}\\` ${statusText}`\n  }\n\n  let comment = `${marker}\\n\\n${title}\\n\\n`\n\n  if (targetStepResult) {\n    // Target step focused comment\n    if (!targetStepResult.found) {\n      if (failedSteps.length > 0) {\n        // If there are failed steps, focus on reporting those failures\n        comment += `${failedSteps.length} of ${totalSteps} step(s) failed:\\n\\n`\n        for (const step of failedSteps) {\n          comment += `- ‚ùå \\`${step.name}\\` (${step.conclusion})\\n`\n        }\n      } else {\n        // Only mention step not found if no other failures\n        comment += `### Did Not Run\\n\\n`\n        comment += `\\`${targetStepResult.name}\\` was not found in the workflow steps.\\n\\n`\n      }\n    } else if (targetStepResult.conclusion === 'success') {\n      // Success case - show stdout/stderr if available\n      const stdout = targetStepResult.stdout\n      const stderr = targetStepResult.stderr\n      const hasStdout = stdout && stdout.trim().length > 0\n      const hasStderr = stderr && stderr.trim().length > 0\n\n      if (!hasStdout && !hasStderr) {\n        comment += `> [!NOTE]\\n> Completed successfully with no output.\\n\\n`\n      } else {\n        if (hasStdout && stdout) {\n          const truncated = truncateOutput(stdout, MAX_OUTPUT_PER_STEP, true)\n          comment += `<details>\\n<summary>üìÑ Output</summary>\\n\\n\\`\\`\\`\\n${truncated}\\n\\`\\`\\`\\n</details>\\n\\n`\n        }\n\n        if (hasStderr && stderr) {\n          const truncated = truncateOutput(stderr, MAX_OUTPUT_PER_STEP, true)\n          comment += `<details>\\n<summary>‚ö†Ô∏è Errors</summary>\\n\\n\\`\\`\\`\\n${truncated}\\n\\`\\`\\`\\n</details>\\n\\n`\n        }\n      }\n    } else {\n      // Target step failed or has other status\n      comment += `**Status:** ${targetStepResult.conclusion}\\n`\n\n      if (targetStepResult.exitCode) {\n        comment += `**Exit Code:** ${targetStepResult.exitCode}\\n`\n      }\n\n      comment += '\\n'\n\n      const stdout = targetStepResult.stdout\n      const stderr = targetStepResult.stderr\n      const hasStdout = stdout && stdout.trim().length > 0\n      const hasStderr = stderr && stderr.trim().length > 0\n\n      if (!hasStdout && !hasStderr) {\n        comment += `> [!NOTE]\\n> Failed with no output.\\n\\n`\n      } else {\n        if (hasStdout && stdout) {\n          const truncated = truncateOutput(stdout, MAX_OUTPUT_PER_STEP, true)\n          comment += `<details>\\n<summary>üìÑ Output</summary>\\n\\n\\`\\`\\`\\n${truncated}\\n\\`\\`\\`\\n</details>\\n\\n`\n        }\n\n        if (hasStderr && stderr) {\n          const truncated = truncateOutput(stderr, MAX_OUTPUT_PER_STEP, true)\n          comment += `<details>\\n<summary>‚ö†Ô∏è Errors</summary>\\n\\n\\`\\`\\`\\n${truncated}\\n\\`\\`\\`\\n</details>\\n\\n`\n        }\n      }\n    }\n  } else {\n    // Normal mode - show all failed steps\n    if (success) {\n      comment += `All ${totalSteps} step(s) completed successfully.\\n`\n    } else {\n      comment += `${failedSteps.length} of ${totalSteps} step(s) failed:\\n\\n`\n\n      for (const step of failedSteps) {\n        comment += `#### ‚ùå Step: \\`${step.name}\\`\\n\\n`\n        comment += `**Status:** ${step.conclusion}\\n`\n\n        if (step.exitCode) {\n          comment += `**Exit Code:** ${step.exitCode}\\n`\n        }\n\n        comment += '\\n'\n\n        const stdout = step.stdout\n        const stderr = step.stderr\n        const hasStdout = stdout && stdout.trim().length > 0\n        const hasStderr = stderr && stderr.trim().length > 0\n\n        if (!hasStdout && !hasStderr) {\n          comment += `> [!NOTE]\\n> Failed with no output.\\n\\n`\n        } else {\n          if (hasStdout && stdout) {\n            const truncated = truncateOutput(stdout, MAX_OUTPUT_PER_STEP, true)\n            comment += `<details>\\n<summary>üìÑ Output</summary>\\n\\n\\`\\`\\`\\n${truncated}\\n\\`\\`\\`\\n</details>\\n\\n`\n          }\n\n          if (hasStderr && stderr) {\n            const truncated = truncateOutput(stderr, MAX_OUTPUT_PER_STEP, true)\n            comment += `<details>\\n<summary>‚ö†Ô∏è Errors</summary>\\n\\n\\`\\`\\`\\n${truncated}\\n\\`\\`\\`\\n</details>\\n\\n`\n          }\n        }\n      }\n    }\n  }\n\n  // Final safety check\n  if (comment.length > MAX_COMMENT_SIZE) {\n    const availableSpace = MAX_COMMENT_SIZE - COMMENT_TRUNCATION_BUFFER\n    comment =\n      comment.substring(0, availableSpace) + '\\n\\n... [comment truncated] ...\\n'\n  }\n\n  return comment\n}\n\nexport function getWorkspaceMarker(workspace: string): string {\n  return `<!-- tf-report-action:\"${workspace}\" -->`\n}\n\nasync function run(): Promise<void> {\n  try {\n    const stepsInput = getInput('steps')\n    let workspace = getInput('workspace')\n    const targetStep = getInput('target-step')\n\n    if (!stepsInput) {\n      setFailed('steps input is required')\n      return\n    }\n\n    // If workspace is not provided, use workflow name and job name\n    if (!workspace) {\n      const workflowName = process.env.GITHUB_WORKFLOW || 'Workflow'\n      const jobName = process.env.GITHUB_JOB || 'Job'\n      workspace = `${workflowName}/${jobName}`\n      info(`No workspace provided, using: \\`${workspace}\\``)\n    }\n\n    let steps: Steps\n    try {\n      steps = JSON.parse(stepsInput)\n    } catch (error) {\n      setFailed(\n        `Failed to parse steps input as JSON: ${error instanceof Error ? error.message : 'Unknown error'}`\n      )\n      return\n    }\n\n    info(\n      `Analyzing ${Object.keys(steps).length} steps for workspace: \\`${workspace}\\`${targetStep ? ` (target: \\`${targetStep}\\`)` : ''}`\n    )\n\n    const analysis = analyzeSteps(steps, targetStep)\n\n    info(\n      `Analysis complete: ${analysis.success ? 'Success' : `Failed (${analysis.failedSteps.length} failures)`}`\n    )\n\n    const context = {\n      repo: process.env.GITHUB_REPOSITORY || '',\n      eventName: process.env.GITHUB_EVENT_NAME || ''\n    }\n\n    if (!context.repo) {\n      info('GITHUB_REPOSITORY not set, skipping comment')\n      return\n    }\n\n    const repoParts = context.repo.split('/')\n    if (repoParts.length !== 2) {\n      info(\n        `Invalid GITHUB_REPOSITORY format: ${context.repo}, skipping comment`\n      )\n      return\n    }\n\n    const [owner, repo] = repoParts\n\n    let issueNumber: number | undefined\n\n    if (\n      context.eventName === 'pull_request' ||\n      context.eventName === 'pull_request_target'\n    ) {\n      const eventPath = process.env.GITHUB_EVENT_PATH\n      if (eventPath) {\n        try {\n          const event = JSON.parse(fs.readFileSync(eventPath, 'utf8'))\n          issueNumber = event.pull_request?.number\n        } catch (error) {\n          info(\n            `Failed to read GitHub event file: ${error instanceof Error ? error.message : 'Unknown error'}`\n          )\n        }\n      }\n    }\n\n    if (!issueNumber) {\n      setFailed(\n        'Not a pull request event - cannot post comment. This action must run in a pull_request event.'\n      )\n      return\n    }\n\n    const token = getInput('github-token')\n    if (!token) {\n      setFailed(\n        'github-token input is required to post comments. Use: github-token: ${{ github.token }}'\n      )\n      return\n    }\n\n    const commentBody = generateCommentBody(workspace, analysis)\n    const marker = getWorkspaceMarker(workspace)\n\n    info(`Comment body length: ${commentBody.length} characters`)\n\n    const existingComments = await getExistingComments(\n      token,\n      repo,\n      owner,\n      issueNumber\n    )\n\n    for (const comment of existingComments) {\n      if (comment.body && comment.body.includes(marker)) {\n        info(`Deleting previous comment for workspace: \\`${workspace}\\``)\n        await deleteComment(token, repo, owner, comment.id)\n      }\n    }\n\n    info(`Posting new comment for workspace: \\`${workspace}\\``)\n    await postComment(token, repo, owner, issueNumber, commentBody)\n\n    info('Comment posted successfully')\n  } catch (error) {\n    if (error instanceof Error) {\n      setFailed(error.message)\n    } else {\n      setFailed('An unknown error occurred')\n    }\n  }\n}\n\n// Run the action if this is the main module\nif (\n  import.meta.url === `file://${process.argv[1]}` ||\n  import.meta.url.endsWith(process.argv[1])\n) {\n  run()\n}\n"],"names":[],"mappings":"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"}