{"version":3,"file":"index.js","sources":["../src/jsonlines.ts","../src/index.ts"],"sourcesContent":["/**\n * OpenTofu/Terraform JSON Lines Output Parser\n *\n * Implements parsing and formatting of machine-readable JSON output as documented at:\n * https://opentofu.org/docs/internals/machine-readable-ui/\n *\n * DOCUMENTATION SOURCE (for future updates):\n * https://github.com/opentofu/opentofu/blob/main/website/docs/internals/machine-readable-ui.mdx\n *\n * This module defines TypeScript interfaces for all message types and provides\n * functions to detect, parse, and format JSON Lines output from OpenTofu/Terraform\n * commands run with the -json flag.\n */\n\n/**\n * Base interface for all JSON messages\n */\ninterface BaseMessage {\n  '@level': 'info' | 'warn' | 'error'\n  '@message': string\n  '@module': string\n  '@timestamp': string\n  type: string\n}\n\n/**\n * Version message - indicates the version of the JSON format\n */\nexport interface VersionMessage extends BaseMessage {\n  type: 'version'\n  tofu: string\n  ui: string\n}\n\n/**\n * Log message - unstructured human-readable log lines\n */\nexport interface LogMessage extends BaseMessage {\n  type: 'log'\n}\n\n/**\n * Diagnostic message - errors, warnings, and info messages\n */\nexport interface DiagnosticMessage extends BaseMessage {\n  type: 'diagnostic'\n  diagnostic: {\n    severity: 'error' | 'warning' | 'info'\n    summary: string\n    detail: string\n    range?: {\n      filename: string\n      start: { line: number; column: number; byte: number }\n      end: { line: number; column: number; byte: number }\n    }\n    snippet?: {\n      context?: string\n      code: string\n      start_line: number\n      highlight_start_offset: number\n      highlight_end_offset: number\n      values?: Array<{ traversal: string; statement: string }>\n    }\n  }\n}\n\n/**\n * Resource drift message - resources that have changed outside of Terraform\n */\nexport interface ResourceDriftMessage extends BaseMessage {\n  type: 'resource_drift'\n  change: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | null\n    }\n    action: 'update' | 'delete' | 'create' | 'read' | 'noop'\n  }\n}\n\n/**\n * Planned change message - describes a change that will be made\n */\nexport interface PlannedChangeMessage extends BaseMessage {\n  type: 'planned_change'\n  change: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    previous_resource?: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    action:\n      | 'noop'\n      | 'create'\n      | 'read'\n      | 'update'\n      | 'replace'\n      | 'delete'\n      | 'move'\n    reason?:\n      | 'tainted'\n      | 'requested'\n      | 'cannot_update'\n      | 'delete_because_no_resource_config'\n      | 'delete_because_wrong_repetition'\n      | 'delete_because_count_index'\n      | 'delete_because_each_key'\n      | 'delete_because_no_module'\n  }\n  prior_state?: unknown\n  config?: unknown\n}\n\n/**\n * Change summary message - summarizes the changes that will be made\n */\nexport interface ChangeSummaryMessage extends BaseMessage {\n  type: 'change_summary'\n  changes: {\n    add: number\n    change: number\n    remove: number\n    import: number\n    operation: 'plan' | 'apply' | 'destroy'\n  }\n}\n\n/**\n * Outputs message - shows output values\n */\nexport interface OutputsMessage extends BaseMessage {\n  type: 'outputs'\n  outputs: {\n    [key: string]: {\n      sensitive: boolean\n      type: string | string[]\n      value: unknown\n    }\n  }\n}\n\n/**\n * Apply start message\n */\nexport interface ApplyStartMessage extends BaseMessage {\n  type: 'apply_start'\n  hook: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    action: string\n    id_key?: string\n    id_value?: string\n  }\n}\n\n/**\n * Apply progress message\n */\nexport interface ApplyProgressMessage extends BaseMessage {\n  type: 'apply_progress'\n  hook: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    action: string\n    elapsed_seconds: number\n  }\n}\n\n/**\n * Apply complete message\n */\nexport interface ApplyCompleteMessage extends BaseMessage {\n  type: 'apply_complete'\n  hook: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    action: string\n    id_key?: string\n    id_value?: string\n    elapsed_seconds: number\n  }\n}\n\n/**\n * Apply errored message\n */\nexport interface ApplyErroredMessage extends BaseMessage {\n  type: 'apply_errored'\n  hook: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    action: string\n  }\n}\n\n/**\n * Provision start message\n */\nexport interface ProvisionStartMessage extends BaseMessage {\n  type: 'provision_start'\n  hook: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    provisioner: string\n  }\n}\n\n/**\n * Provision progress message\n */\nexport interface ProvisionProgressMessage extends BaseMessage {\n  type: 'provision_progress'\n  hook: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    provisioner: string\n    output: string\n  }\n}\n\n/**\n * Provision complete message\n */\nexport interface ProvisionCompleteMessage extends BaseMessage {\n  type: 'provision_complete'\n  hook: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    provisioner: string\n  }\n}\n\n/**\n * Provision errored message\n */\nexport interface ProvisionErroredMessage extends BaseMessage {\n  type: 'provision_errored'\n  hook: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    provisioner: string\n  }\n}\n\n/**\n * Refresh start message\n */\nexport interface RefreshStartMessage extends BaseMessage {\n  type: 'refresh_start'\n  hook: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    id_key?: string\n    id_value?: string\n  }\n}\n\n/**\n * Refresh complete message\n */\nexport interface RefreshCompleteMessage extends BaseMessage {\n  type: 'refresh_complete'\n  hook: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    id_key?: string\n    id_value?: string\n  }\n}\n\n/**\n * Test abstract message - summary of test files and tests found\n */\nexport interface TestAbstractMessage extends BaseMessage {\n  type: 'test_abstract'\n  test_abstract: {\n    [filename: string]: string[]\n  }\n}\n\n/**\n * Test file message - summary of test file execution\n */\nexport interface TestFileMessage extends BaseMessage {\n  type: 'test_file'\n  test_file: {\n    path: string\n    status: string\n  }\n}\n\n/**\n * Test run message - summary of test execution\n */\nexport interface TestRunMessage extends BaseMessage {\n  type: 'test_run'\n  test_run: {\n    path: string\n    run: string\n    status: string\n  }\n}\n\n/**\n * Test summary message - summary of overall test file execution\n */\nexport interface TestSummaryMessage extends BaseMessage {\n  type: 'test_summary'\n  test_summary: {\n    status: string\n    passed: number\n    failed: number\n    errored: number\n    skipped: number\n  }\n}\n\n/**\n * Union type of all message types\n */\nexport type JsonLineMessage =\n  | VersionMessage\n  | LogMessage\n  | DiagnosticMessage\n  | ResourceDriftMessage\n  | PlannedChangeMessage\n  | ChangeSummaryMessage\n  | OutputsMessage\n  | ApplyStartMessage\n  | ApplyProgressMessage\n  | ApplyCompleteMessage\n  | ApplyErroredMessage\n  | ProvisionStartMessage\n  | ProvisionProgressMessage\n  | ProvisionCompleteMessage\n  | ProvisionErroredMessage\n  | RefreshStartMessage\n  | RefreshCompleteMessage\n  | TestAbstractMessage\n  | TestFileMessage\n  | TestRunMessage\n  | TestSummaryMessage\n\n/**\n * Parsed result containing all messages\n */\nexport interface ParsedJsonLines {\n  messages: JsonLineMessage[]\n  diagnostics: DiagnosticMessage[]\n  plannedChanges: PlannedChangeMessage[]\n  changeSummary?: ChangeSummaryMessage\n  resourceDrifts: ResourceDriftMessage[]\n  outputs?: OutputsMessage\n  hasErrors: boolean\n}\n\n/**\n * Check if a string appears to be JSON Lines format\n */\nexport function isJsonLines(text: string): boolean {\n  if (!text || text.trim().length === 0) {\n    return false\n  }\n\n  const lines = text.split('\\n').filter((line) => line.trim().length > 0)\n\n  // Need at least one line\n  if (lines.length === 0) {\n    return false\n  }\n\n  // Check if first few lines are valid JSON objects with required fields\n  const samplesToCheck = Math.min(lines.length, 3)\n  let validJsonCount = 0\n\n  for (let i = 0; i < samplesToCheck; i++) {\n    try {\n      const parsed = JSON.parse(lines[i])\n      // Check for required fields in OpenTofu/Terraform JSON output\n      if (\n        parsed &&\n        typeof parsed === 'object' &&\n        'type' in parsed &&\n        '@message' in parsed\n      ) {\n        validJsonCount++\n      }\n    } catch {\n      // Not valid JSON, continue checking other lines\n    }\n  }\n\n  // If at least one line is valid JSON with required fields, consider it JSON Lines\n  return validJsonCount > 0\n}\n\n/**\n * Parse JSON Lines output into structured messages\n */\nexport function parseJsonLines(text: string): ParsedJsonLines {\n  const lines = text.split('\\n').filter((line) => line.trim().length > 0)\n\n  const messages: JsonLineMessage[] = []\n  const diagnostics: DiagnosticMessage[] = []\n  const plannedChanges: PlannedChangeMessage[] = []\n  const resourceDrifts: ResourceDriftMessage[] = []\n  let changeSummary: ChangeSummaryMessage | undefined\n  let outputs: OutputsMessage | undefined\n  let hasErrors = false\n\n  for (const line of lines) {\n    try {\n      const parsed = JSON.parse(line) as JsonLineMessage\n\n      messages.push(parsed)\n\n      // Categorize by type\n      switch (parsed.type) {\n        case 'diagnostic':\n          diagnostics.push(parsed as DiagnosticMessage)\n          if (parsed.diagnostic.severity === 'error') {\n            hasErrors = true\n          }\n          break\n        case 'planned_change':\n          plannedChanges.push(parsed as PlannedChangeMessage)\n          break\n        case 'change_summary':\n          changeSummary = parsed as ChangeSummaryMessage\n          break\n        case 'resource_drift':\n          resourceDrifts.push(parsed as ResourceDriftMessage)\n          break\n        case 'outputs':\n          outputs = parsed as OutputsMessage\n          break\n      }\n    } catch {\n      // Skip lines that aren't valid JSON\n    }\n  }\n\n  return {\n    messages,\n    diagnostics,\n    plannedChanges,\n    changeSummary,\n    resourceDrifts,\n    outputs,\n    hasErrors\n  }\n}\n\n/**\n * Get emoji for a change action\n */\nfunction getActionEmoji(\n  action: string\n):\n  | ':heavy_plus_sign:'\n  | 'üîÑ'\n  | ':heavy_minus_sign:'\n  | '¬±'\n  | 'üìñ'\n  | 'üöö'\n  | '‚ö™' {\n  switch (action) {\n    case 'create':\n      return ':heavy_plus_sign:'\n    case 'update':\n      return 'üîÑ'\n    case 'delete':\n    case 'remove':\n      return ':heavy_minus_sign:'\n    case 'replace':\n      return '¬±'\n    case 'read':\n      return 'üìñ'\n    case 'move':\n      return 'üöö'\n    case 'noop':\n    default:\n      return '‚ö™'\n  }\n}\n\n/**\n * Format a planned change for display\n */\nfunction formatPlannedChange(change: PlannedChangeMessage): string {\n  const emoji = getActionEmoji(change.change.action)\n  const resource = change.change.resource\n  const addr =\n    resource.addr || `${resource.resource_type}.${resource.resource_name}`\n\n  return `${emoji} **${addr}** (${change.change.action})`\n}\n\n/**\n * Format a diagnostic message for display\n */\nfunction formatDiagnostic(diag: DiagnosticMessage): string {\n  const icon =\n    diag.diagnostic.severity === 'error'\n      ? '‚ùå'\n      : diag.diagnostic.severity === 'warning'\n        ? '‚ö†Ô∏è'\n        : '‚ÑπÔ∏è'\n\n  let result = `${icon} **${diag.diagnostic.summary}**`\n\n  if (diag.diagnostic.detail) {\n    result += `\\n\\n${diag.diagnostic.detail}`\n  }\n\n  if (diag.diagnostic.range) {\n    result += `\\n\\nüìÑ \\`${diag.diagnostic.range.filename}:${diag.diagnostic.range.start.line}\\``\n  }\n\n  if (diag.diagnostic.snippet?.code) {\n    result += '\\n\\n```hcl\\n' + diag.diagnostic.snippet.code + '\\n```'\n  }\n\n  return result\n}\n\n/**\n * Format change summary for display\n */\nfunction formatChangeSummary(summary: ChangeSummaryMessage): string {\n  const { add, change, remove } = summary.changes\n  const operation =\n    summary.changes.operation.charAt(0).toUpperCase() +\n    summary.changes.operation.slice(1)\n\n  const parts: string[] = []\n  if (add > 0) parts.push(`**${add}** to add :heavy_plus_sign:`)\n  if (change > 0) parts.push(`**${change}** to change üîÑ`)\n  if (remove > 0) parts.push(`**${remove}** to remove :heavy_minus_sign:`)\n\n  if (parts.length === 0) {\n    return `**${operation}:** No changes.`\n  }\n\n  return `**${operation}:** ${parts.join(', ')}`\n}\n\n/**\n * Format parsed JSON Lines into a markdown comment\n */\nexport function formatJsonLines(parsed: ParsedJsonLines): string {\n  let result = ''\n\n  // Show change summary first (outside of any collapsing)\n  if (parsed.changeSummary) {\n    result += formatChangeSummary(parsed.changeSummary) + '\\n\\n'\n  }\n\n  // Show diagnostics (errors and warnings)\n  if (parsed.diagnostics.length > 0) {\n    const errors = parsed.diagnostics.filter(\n      (d) => d.diagnostic.severity === 'error'\n    )\n    const warnings = parsed.diagnostics.filter(\n      (d) => d.diagnostic.severity === 'warning'\n    )\n\n    if (errors.length > 0) {\n      result += '### ‚ùå Errors\\n\\n'\n      for (const error of errors) {\n        result += formatDiagnostic(error) + '\\n\\n'\n      }\n    }\n\n    if (warnings.length > 0) {\n      result += '### ‚ö†Ô∏è Warnings\\n\\n'\n      for (const warning of warnings) {\n        result += formatDiagnostic(warning) + '\\n\\n'\n      }\n    }\n  }\n\n  // Show planned changes in a collapsible section\n  if (parsed.plannedChanges.length > 0) {\n    result += '<details>\\n<summary>üìã Planned Changes</summary>\\n\\n'\n    for (const change of parsed.plannedChanges) {\n      result += formatPlannedChange(change) + '\\n'\n    }\n    result += '\\n</details>\\n\\n'\n  }\n\n  // Show resource drifts if any\n  if (parsed.resourceDrifts.length > 0) {\n    result += '<details>\\n<summary>üîÄ Resource Drift</summary>\\n\\n'\n    for (const drift of parsed.resourceDrifts) {\n      const emoji = getActionEmoji(drift.change.action)\n      const addr =\n        drift.change.resource.addr ||\n        `${drift.change.resource.resource_type}.${drift.change.resource.resource_name}`\n      result += `${emoji} **${addr}** (${drift.change.action})\\n`\n    }\n    result += '\\n</details>\\n\\n'\n  }\n\n  return result.trim()\n}\n","import * as https from 'https'\nimport * as fs from 'fs'\nimport { isJsonLines, parseJsonLines, formatJsonLines } from './jsonlines.js'\n\n// Re-export jsonlines functions for use by scripts and tests\nexport { isJsonLines, parseJsonLines, formatJsonLines }\n\ninterface StepData {\n  conclusion?: string\n  outcome?: string\n  outputs?: {\n    stdout?: string\n    stderr?: string\n    exit_code?: string\n    [key: string]: unknown\n  }\n}\n\ninterface Steps {\n  [key: string]: StepData\n}\n\ninterface StepFailure {\n  name: string\n  conclusion: string\n  stdout?: string\n  stderr?: string\n  exitCode?: string\n}\n\ninterface AnalysisResult {\n  success: boolean\n  failedSteps: StepFailure[]\n  totalSteps: number\n  targetStepResult?: {\n    name: string\n    found: boolean\n    conclusion?: string\n    stdout?: string\n    stderr?: string\n    exitCode?: string\n  }\n}\n\n// GitHub comment max size is 65536 characters\nconst MAX_COMMENT_SIZE = 60000\nconst MAX_OUTPUT_PER_STEP = 20000\nconst COMMENT_TRUNCATION_BUFFER = 1000\n\n/**\n * Get an input value from the environment\n */\nexport function getInput(name: string): string {\n  const val =\n    process.env[`INPUT_${name.replace(/ /g, '_').toUpperCase()}`] || ''\n  return val.trim()\n}\n\n/**\n * Log an informational message\n */\nfunction info(message: string): void {\n  console.log(message)\n}\n\n/**\n * Set the action as failed and exit\n */\nexport function setFailed(message: string): void {\n  console.error(`::error::${message}`)\n  process.exit(1)\n}\n\nasync function httpsRequest(\n  options: https.RequestOptions,\n  data?: string\n): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const req = https.request(options, (res) => {\n      const chunks: Buffer[] = []\n      res.on('data', (chunk) => chunks.push(chunk))\n      res.on('end', () => {\n        const body = Buffer.concat(chunks).toString('utf8')\n        if (res.statusCode && res.statusCode >= 200 && res.statusCode < 300) {\n          resolve(body)\n        } else {\n          reject(new Error(`HTTP ${res.statusCode}: ${body}`))\n        }\n      })\n    })\n    req.on('error', reject)\n    if (data) {\n      req.write(data)\n    }\n    req.end()\n  })\n}\n\nasync function getExistingComments(\n  token: string,\n  repo: string,\n  owner: string,\n  issueNumber: number\n): Promise<Array<{ id: number; body: string }>> {\n  const options: https.RequestOptions = {\n    hostname: 'api.github.com',\n    path: `/repos/${owner}/${repo}/issues/${issueNumber}/comments`,\n    method: 'GET',\n    headers: {\n      Authorization: `Bearer ${token}`,\n      'User-Agent': 'tf-report-action',\n      Accept: 'application/vnd.github+json'\n    }\n  }\n\n  const response = await httpsRequest(options)\n  return JSON.parse(response)\n}\n\nasync function deleteComment(\n  token: string,\n  repo: string,\n  owner: string,\n  commentId: number\n): Promise<void> {\n  const options: https.RequestOptions = {\n    hostname: 'api.github.com',\n    path: `/repos/${owner}/${repo}/issues/comments/${commentId}`,\n    method: 'DELETE',\n    headers: {\n      Authorization: `Bearer ${token}`,\n      'User-Agent': 'tf-report-action',\n      Accept: 'application/vnd.github+json'\n    }\n  }\n\n  await httpsRequest(options)\n}\n\nasync function postComment(\n  token: string,\n  repo: string,\n  owner: string,\n  issueNumber: number,\n  body: string\n): Promise<void> {\n  const options: https.RequestOptions = {\n    hostname: 'api.github.com',\n    path: `/repos/${owner}/${repo}/issues/${issueNumber}/comments`,\n    method: 'POST',\n    headers: {\n      Authorization: `Bearer ${token}`,\n      'User-Agent': 'tf-report-action',\n      Accept: 'application/vnd.github+json',\n      'Content-Type': 'application/json'\n    }\n  }\n\n  const payload = JSON.stringify({ body })\n  await httpsRequest(options, payload)\n}\n\nasync function searchIssues(\n  token: string,\n  repo: string,\n  owner: string,\n  query: string\n): Promise<Array<{ number: number; title: string; body: string }>> {\n  const encodedQuery = encodeURIComponent(query)\n  const options: https.RequestOptions = {\n    hostname: 'api.github.com',\n    path: `/search/issues?q=${encodedQuery}`,\n    method: 'GET',\n    headers: {\n      Authorization: `Bearer ${token}`,\n      'User-Agent': 'tf-report-action',\n      Accept: 'application/vnd.github+json'\n    }\n  }\n\n  const response = await httpsRequest(options)\n  try {\n    const result = JSON.parse(response)\n    return result.items || []\n  } catch (error) {\n    throw new Error(\n      `Failed to parse search issues response: ${error instanceof Error ? error.message : 'Unknown error'}`\n    )\n  }\n}\n\nasync function createIssue(\n  token: string,\n  repo: string,\n  owner: string,\n  title: string,\n  body: string\n): Promise<number> {\n  const options: https.RequestOptions = {\n    hostname: 'api.github.com',\n    path: `/repos/${owner}/${repo}/issues`,\n    method: 'POST',\n    headers: {\n      Authorization: `Bearer ${token}`,\n      'User-Agent': 'tf-report-action',\n      Accept: 'application/vnd.github+json',\n      'Content-Type': 'application/json'\n    }\n  }\n\n  const payload = JSON.stringify({ title, body })\n  const response = await httpsRequest(options, payload)\n  try {\n    const issue = JSON.parse(response)\n    if (!issue.number) {\n      throw new Error('API response missing issue number')\n    }\n    return issue.number\n  } catch (error) {\n    throw new Error(\n      `Failed to parse create issue response: ${error instanceof Error ? error.message : 'Unknown error'}`\n    )\n  }\n}\n\nasync function updateIssue(\n  token: string,\n  repo: string,\n  owner: string,\n  issueNumber: number,\n  title: string,\n  body: string\n): Promise<void> {\n  const options: https.RequestOptions = {\n    hostname: 'api.github.com',\n    path: `/repos/${owner}/${repo}/issues/${issueNumber}`,\n    method: 'PATCH',\n    headers: {\n      Authorization: `Bearer ${token}`,\n      'User-Agent': 'tf-report-action',\n      Accept: 'application/vnd.github+json',\n      'Content-Type': 'application/json'\n    }\n  }\n\n  const payload = JSON.stringify({ title, body })\n  await httpsRequest(options, payload)\n}\n\n/**\n * Get the GitHub job logs URL\n */\nexport function getJobLogsUrl(): string {\n  const repo = process.env.GITHUB_REPOSITORY || ''\n  const runId = process.env.GITHUB_RUN_ID || ''\n  const runAttempt = process.env.GITHUB_RUN_ATTEMPT || '1'\n\n  if (repo && runId) {\n    return `https://github.com/${repo}/actions/runs/${runId}/attempts/${runAttempt}`\n  }\n  return ''\n}\n\nexport function truncateOutput(\n  text: string,\n  maxLength: number,\n  includeLogLink = false\n): string {\n  if (text.length <= maxLength) return text\n\n  const logLink = includeLogLink ? getJobLogsUrl() : ''\n  const truncationMessage = logLink\n    ? `\\n\\n... [output truncated - [view full logs](${logLink})] ...\\n\\n`\n    : '\\n\\n... [output truncated] ...\\n\\n'\n  const availableLength = maxLength - truncationMessage.length\n\n  if (availableLength <= 0) {\n    return text.substring(0, maxLength)\n  }\n\n  const halfLength = Math.floor(availableLength / 2)\n  return (\n    text.substring(0, halfLength) +\n    truncationMessage +\n    text.substring(text.length - halfLength)\n  )\n}\n\nexport function analyzeSteps(\n  steps: Steps,\n  targetStep?: string\n): AnalysisResult {\n  const stepEntries = Object.entries(steps)\n  const totalSteps = stepEntries.length\n  const failedSteps: StepFailure[] = []\n  let targetStepResult\n\n  for (const [stepName, stepData] of stepEntries) {\n    const conclusion = stepData.conclusion || stepData.outcome || ''\n\n    // Check if this is the target step\n    if (targetStep && stepName === targetStep) {\n      targetStepResult = {\n        name: stepName,\n        found: true,\n        conclusion,\n        stdout: stepData.outputs?.stdout as string | undefined,\n        stderr: stepData.outputs?.stderr as string | undefined,\n        exitCode: stepData.outputs?.exit_code as string | undefined\n      }\n    }\n\n    // Treat as failure if not success, skipped, cancelled, or neutral\n    if (\n      conclusion &&\n      conclusion !== 'success' &&\n      conclusion !== 'skipped' &&\n      conclusion !== 'cancelled' &&\n      conclusion !== 'neutral'\n    ) {\n      const failure: StepFailure = {\n        name: stepName,\n        conclusion,\n        stdout: stepData.outputs?.stdout as string | undefined,\n        stderr: stepData.outputs?.stderr as string | undefined,\n        exitCode: stepData.outputs?.exit_code as string | undefined\n      }\n      failedSteps.push(failure)\n    }\n  }\n\n  // If target step was specified but not found\n  if (targetStep && !targetStepResult) {\n    targetStepResult = {\n      name: targetStep,\n      found: false\n    }\n  }\n\n  return {\n    success: failedSteps.length === 0,\n    failedSteps,\n    totalSteps,\n    targetStepResult\n  }\n}\n\nexport function generateCommentBody(\n  workspace: string,\n  analysis: AnalysisResult\n): string {\n  const { success, failedSteps, totalSteps, targetStepResult } = analysis\n  const marker = `<!-- tf-report-action:\"${workspace}\" -->`\n  const title = generateTitle(workspace, analysis)\n\n  let comment = `${marker}\\n\\n## ${title}\\n\\n`\n\n  if (targetStepResult) {\n    // Target step focused comment\n    if (!targetStepResult.found) {\n      if (failedSteps.length > 0) {\n        // If there are failed steps, focus on reporting those failures\n        comment += `${failedSteps.length} of ${totalSteps} step(s) failed:\\n\\n`\n        for (const step of failedSteps) {\n          comment += `- ‚ùå \\`${step.name}\\` (${step.conclusion})\\n`\n        }\n      } else {\n        // Only mention step not found if no other failures\n        comment += `### Did Not Run\\n\\n`\n        comment += `\\`${targetStepResult.name}\\` was not found in the workflow steps.\\n\\n`\n      }\n    } else if (targetStepResult.conclusion === 'success') {\n      // Success case - show stdout/stderr if available\n      const stdout = targetStepResult.stdout\n      const stderr = targetStepResult.stderr\n      const { formattedContent } = formatOutput(stdout, stderr)\n\n      if (!formattedContent) {\n        comment += `> [!NOTE]\\n> Completed successfully with no output.\\n\\n`\n      } else {\n        comment += formattedContent\n      }\n    } else {\n      // Target step failed or has other status\n      comment += `**Status:** ${targetStepResult.conclusion}\\n`\n\n      if (targetStepResult.exitCode) {\n        comment += `**Exit Code:** ${targetStepResult.exitCode}\\n`\n      }\n\n      comment += '\\n'\n\n      const stdout = targetStepResult.stdout\n      const stderr = targetStepResult.stderr\n      const { formattedContent } = formatOutput(stdout, stderr)\n\n      if (!formattedContent) {\n        comment += `> [!NOTE]\\n> Failed with no output.\\n\\n`\n      } else {\n        comment += formattedContent\n      }\n    }\n  } else {\n    // Normal mode - show all failed steps\n    if (success) {\n      comment += `All ${totalSteps} step(s) completed successfully.\\n`\n    } else {\n      comment += `${failedSteps.length} of ${totalSteps} step(s) failed:\\n\\n`\n\n      for (const step of failedSteps) {\n        comment += `#### ‚ùå Step: \\`${step.name}\\`\\n\\n`\n        comment += `**Status:** ${step.conclusion}\\n`\n\n        if (step.exitCode) {\n          comment += `**Exit Code:** ${step.exitCode}\\n`\n        }\n\n        comment += '\\n'\n\n        const { formattedContent } = formatOutput(step.stdout, step.stderr)\n\n        if (!formattedContent) {\n          comment += `> [!NOTE]\\n> Failed with no output.\\n\\n`\n        } else {\n          comment += formattedContent\n        }\n      }\n    }\n  }\n\n  // Final safety check\n  if (comment.length > MAX_COMMENT_SIZE) {\n    const availableSpace = MAX_COMMENT_SIZE - COMMENT_TRUNCATION_BUFFER\n    comment =\n      comment.substring(0, availableSpace) + '\\n\\n... [comment truncated] ...\\n'\n  }\n\n  return comment\n}\n\nexport function getWorkspaceMarker(workspace: string): string {\n  // Escape double quotes in workspace name to prevent breaking the HTML comment\n  const escapedWorkspace = workspace.replace(/\"/g, '\\\\\"')\n  return `<!-- tf-report-action:\"${escapedWorkspace}\" -->`\n}\n\n/**\n * Generate title for the comment/issue\n */\nexport function generateTitle(\n  workspace: string,\n  analysis: AnalysisResult\n): string {\n  const { success, targetStepResult } = analysis\n  let statusIcon = ''\n  let statusText = ''\n\n  if (targetStepResult) {\n    // Target step mode\n    // Show as failure if target step didn't run or overall workflow failed\n    const showAsFailure = !targetStepResult.found || !success\n\n    statusIcon = showAsFailure ? '‚ùå' : '‚úÖ'\n    statusText = showAsFailure ? 'Failed' : 'Succeeded'\n    return `${statusIcon} \\`${workspace}\\` \\`${targetStepResult.name}\\` ${statusText}`\n  } else {\n    // Normal mode\n    statusIcon = success ? '‚úÖ' : '‚ùå'\n    statusText = success ? 'Succeeded' : 'Failed'\n    return `${statusIcon} \\`${workspace}\\` ${statusText}`\n  }\n}\n\n/**\n * Format output, detecting and handling JSON Lines format\n */\nfunction formatOutput(\n  stdout: string | undefined,\n  stderr: string | undefined\n): { formattedContent: string; isJsonLines: boolean } {\n  const hasStdout = stdout && stdout.trim().length > 0\n  const hasStderr = stderr && stderr.trim().length > 0\n\n  // Check if stdout is JSON Lines format\n  if (hasStdout && stdout && isJsonLines(stdout)) {\n    const parsed = parseJsonLines(stdout)\n    const formatted = formatJsonLines(parsed)\n\n    if (formatted.trim().length > 0) {\n      return { formattedContent: formatted, isJsonLines: true }\n    }\n  }\n\n  // Fall back to standard output formatting\n  let content = ''\n\n  if (!hasStdout && !hasStderr) {\n    return { formattedContent: '', isJsonLines: false }\n  }\n\n  if (hasStdout && stdout) {\n    const truncated = truncateOutput(stdout, MAX_OUTPUT_PER_STEP, true)\n    content += `<details>\\n<summary>üìÑ Output</summary>\\n\\n\\`\\`\\`\\n${truncated}\\n\\`\\`\\`\\n</details>\\n\\n`\n  }\n\n  if (hasStderr && stderr) {\n    const truncated = truncateOutput(stderr, MAX_OUTPUT_PER_STEP, true)\n    content += `<details>\\n<summary>‚ö†Ô∏è Errors</summary>\\n\\n\\`\\`\\`\\n${truncated}\\n\\`\\`\\`\\n</details>\\n\\n`\n  }\n\n  return { formattedContent: content, isJsonLines: false }\n}\n\nasync function run(): Promise<void> {\n  try {\n    const stepsInput = getInput('steps')\n    let workspace = getInput('workspace')\n    const targetStep = getInput('target-step')\n\n    if (!stepsInput) {\n      setFailed('steps input is required')\n      return\n    }\n\n    // If workspace is not provided, use workflow name and job name\n    if (!workspace) {\n      const workflowName = process.env.GITHUB_WORKFLOW || 'Workflow'\n      const jobName = process.env.GITHUB_JOB || 'Job'\n      workspace = `${workflowName}/${jobName}`\n      info(`No workspace provided, using: \\`${workspace}\\``)\n    }\n\n    let steps: Steps\n    try {\n      steps = JSON.parse(stepsInput)\n    } catch (error) {\n      setFailed(\n        `Failed to parse steps input as JSON: ${error instanceof Error ? error.message : 'Unknown error'}`\n      )\n      return\n    }\n\n    info(\n      `Analyzing ${Object.keys(steps).length} steps for workspace: \\`${workspace}\\`${targetStep ? ` (target: \\`${targetStep}\\`)` : ''}`\n    )\n\n    const analysis = analyzeSteps(steps, targetStep)\n\n    info(\n      `Analysis complete: ${analysis.success ? 'Success' : `Failed (${analysis.failedSteps.length} failures)`}`\n    )\n\n    const context = {\n      repo: process.env.GITHUB_REPOSITORY || '',\n      eventName: process.env.GITHUB_EVENT_NAME || ''\n    }\n\n    if (!context.repo) {\n      info('GITHUB_REPOSITORY not set, skipping comment/issue')\n      return\n    }\n\n    const repoParts = context.repo.split('/')\n    if (repoParts.length !== 2) {\n      info(\n        `Invalid GITHUB_REPOSITORY format: ${context.repo}, skipping comment/issue`\n      )\n      return\n    }\n\n    const [owner, repo] = repoParts\n\n    const token = getInput('github-token')\n    if (!token) {\n      setFailed(\n        'github-token input is required to post comments/issues. Use: github-token: ${{ github.token }}'\n      )\n      return\n    }\n\n    const commentBody = generateCommentBody(workspace, analysis)\n    const marker = getWorkspaceMarker(workspace)\n    const title = generateTitle(workspace, analysis)\n\n    info(`Comment/Issue body length: ${commentBody.length} characters`)\n\n    let issueNumber: number | undefined\n\n    // Check if this is a pull request event\n    if (\n      context.eventName === 'pull_request' ||\n      context.eventName === 'pull_request_target'\n    ) {\n      const eventPath = process.env.GITHUB_EVENT_PATH\n      if (eventPath) {\n        try {\n          const event = JSON.parse(fs.readFileSync(eventPath, 'utf8'))\n          issueNumber = event.pull_request?.number\n        } catch (error) {\n          info(\n            `Failed to read GitHub event file: ${error instanceof Error ? error.message : 'Unknown error'}`\n          )\n        }\n      }\n    }\n\n    if (issueNumber) {\n      // PR context: post as comment\n      info('Running in PR context - posting as comment')\n\n      const existingComments = await getExistingComments(\n        token,\n        repo,\n        owner,\n        issueNumber\n      )\n\n      for (const comment of existingComments) {\n        if (comment.body && comment.body.includes(marker)) {\n          info(`Deleting previous comment for workspace: \\`${workspace}\\``)\n          await deleteComment(token, repo, owner, comment.id)\n        }\n      }\n\n      info(`Posting new comment for workspace: \\`${workspace}\\``)\n      await postComment(token, repo, owner, issueNumber, commentBody)\n\n      info('Comment posted successfully')\n    } else {\n      // Non-PR context: use status issue\n      info('Not in PR context - using status issue')\n      info(`Status issue title: \"${title}\"`)\n\n      // Search for existing status issue with the marker in body\n      const query = `repo:${owner}/${repo} is:issue in:body \"${marker}\"`\n      const existingIssues = await searchIssues(token, repo, owner, query)\n\n      let statusIssueNumber: number | undefined\n\n      // Find the issue that matches our workspace marker\n      for (const issue of existingIssues) {\n        if (issue.body && issue.body.includes(marker)) {\n          statusIssueNumber = issue.number\n          info(\n            `Found existing status issue #${statusIssueNumber} for workspace: \\`${workspace}\\``\n          )\n          break\n        }\n      }\n\n      if (statusIssueNumber) {\n        // Update existing issue\n        info(`Updating status issue #${statusIssueNumber}`)\n        await updateIssue(\n          token,\n          repo,\n          owner,\n          statusIssueNumber,\n          title,\n          commentBody\n        )\n        info('Status issue updated successfully')\n      } else {\n        // Create new issue\n        info(`Creating new status issue for workspace: \\`${workspace}\\``)\n        statusIssueNumber = await createIssue(\n          token,\n          repo,\n          owner,\n          title,\n          commentBody\n        )\n        info(`Status issue #${statusIssueNumber} created successfully`)\n      }\n    }\n  } catch (error) {\n    if (error instanceof Error) {\n      setFailed(error.message)\n    } else {\n      setFailed('An unknown error occurred')\n    }\n  }\n}\n\n// Run the action if this is the main module\nif (\n  import.meta.url === `file://${process.argv[1]}` ||\n  import.meta.url.endsWith(process.argv[1])\n) {\n  run()\n}\n"],"names":[],"mappings":"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"}