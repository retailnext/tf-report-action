{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import * as https from 'https'\nimport * as fs from 'fs'\n\ninterface StepData {\n  conclusion?: string\n  outcome?: string\n  outputs?: {\n    stdout?: string\n    stderr?: string\n    exit_code?: string\n    [key: string]: unknown\n  }\n}\n\ninterface Steps {\n  [key: string]: StepData\n}\n\ninterface StepFailure {\n  name: string\n  conclusion: string\n  stdout?: string\n  stderr?: string\n  exitCode?: string\n}\n\ninterface AnalysisResult {\n  success: boolean\n  failedSteps: StepFailure[]\n  totalSteps: number\n}\n\n// GitHub comment max size is 65536 characters\nconst MAX_COMMENT_SIZE = 60000\nconst MAX_OUTPUT_PER_STEP = 20000\nconst COMMENT_TRUNCATION_BUFFER = 1000\n\nexport function getInput(name: string): string {\n  const val =\n    process.env[`INPUT_${name.replace(/[ -]/g, '_').toUpperCase()}`] || ''\n  return val.trim()\n}\n\nexport function setFailed(message: string): void {\n  console.error(`::error::${message}`)\n  process.exit(1)\n}\n\nasync function httpsRequest(\n  options: https.RequestOptions,\n  data?: string\n): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const req = https.request(options, (res) => {\n      const chunks: Buffer[] = []\n      res.on('data', (chunk) => chunks.push(chunk))\n      res.on('end', () => {\n        const body = Buffer.concat(chunks).toString('utf8')\n        if (res.statusCode && res.statusCode >= 200 && res.statusCode < 300) {\n          resolve(body)\n        } else {\n          reject(new Error(`HTTP ${res.statusCode}: ${body}`))\n        }\n      })\n    })\n    req.on('error', reject)\n    if (data) {\n      req.write(data)\n    }\n    req.end()\n  })\n}\n\nasync function getExistingComments(\n  token: string,\n  repo: string,\n  owner: string,\n  issueNumber: number\n): Promise<Array<{ id: number; body: string }>> {\n  const options: https.RequestOptions = {\n    hostname: 'api.github.com',\n    path: `/repos/${owner}/${repo}/issues/${issueNumber}/comments`,\n    method: 'GET',\n    headers: {\n      Authorization: `Bearer ${token}`,\n      'User-Agent': 'tf-report-action',\n      Accept: 'application/vnd.github+json'\n    }\n  }\n\n  const response = await httpsRequest(options)\n  return JSON.parse(response)\n}\n\nasync function deleteComment(\n  token: string,\n  repo: string,\n  owner: string,\n  commentId: number\n): Promise<void> {\n  const options: https.RequestOptions = {\n    hostname: 'api.github.com',\n    path: `/repos/${owner}/${repo}/issues/comments/${commentId}`,\n    method: 'DELETE',\n    headers: {\n      Authorization: `Bearer ${token}`,\n      'User-Agent': 'tf-report-action',\n      Accept: 'application/vnd.github+json'\n    }\n  }\n\n  await httpsRequest(options)\n}\n\nasync function postComment(\n  token: string,\n  repo: string,\n  owner: string,\n  issueNumber: number,\n  body: string\n): Promise<void> {\n  const options: https.RequestOptions = {\n    hostname: 'api.github.com',\n    path: `/repos/${owner}/${repo}/issues/${issueNumber}/comments`,\n    method: 'POST',\n    headers: {\n      Authorization: `Bearer ${token}`,\n      'User-Agent': 'tf-report-action',\n      Accept: 'application/vnd.github+json',\n      'Content-Type': 'application/json'\n    }\n  }\n\n  const payload = JSON.stringify({ body })\n  await httpsRequest(options, payload)\n}\n\nexport function truncateOutput(text: string, maxLength: number): string {\n  if (text.length <= maxLength) return text\n\n  const truncationMessage = '\\n\\n... [output truncated] ...\\n\\n'\n  const availableLength = maxLength - truncationMessage.length\n\n  if (availableLength <= 0) {\n    return text.substring(0, maxLength)\n  }\n\n  const halfLength = Math.floor(availableLength / 2)\n  return (\n    text.substring(0, halfLength) +\n    truncationMessage +\n    text.substring(text.length - halfLength)\n  )\n}\n\nexport function analyzeSteps(steps: Steps): AnalysisResult {\n  const stepEntries = Object.entries(steps)\n  const totalSteps = stepEntries.length\n  const failedSteps: StepFailure[] = []\n\n  for (const [stepName, stepData] of stepEntries) {\n    const conclusion = stepData.conclusion || stepData.outcome || ''\n    // Treat as failure if not success, skipped, cancelled, or neutral\n    if (\n      conclusion &&\n      conclusion !== 'success' &&\n      conclusion !== 'skipped' &&\n      conclusion !== 'cancelled' &&\n      conclusion !== 'neutral'\n    ) {\n      const failure: StepFailure = {\n        name: stepName,\n        conclusion,\n        stdout: stepData.outputs?.stdout as string | undefined,\n        stderr: stepData.outputs?.stderr as string | undefined,\n        exitCode: stepData.outputs?.exit_code as string | undefined\n      }\n      failedSteps.push(failure)\n    }\n  }\n\n  return {\n    success: failedSteps.length === 0,\n    failedSteps,\n    totalSteps\n  }\n}\n\nexport function generateCommentBody(\n  workspace: string,\n  analysis: AnalysisResult\n): string {\n  const { success, failedSteps, totalSteps } = analysis\n  const marker = `<!-- tf-report-action:${workspace} -->`\n  const statusIcon = success ? '‚úÖ' : '‚ùå'\n  const statusText = success ? 'Success' : 'Failed'\n\n  let comment = `${marker}\\n\\n`\n  comment += `## OpenTofu Workflow Report - \\`${workspace}\\`\\n\\n`\n  comment += `### ${statusIcon} ${statusText}\\n\\n`\n\n  if (success) {\n    comment += `All ${totalSteps} step(s) completed successfully.\\n`\n  } else {\n    comment += `${failedSteps.length} of ${totalSteps} step(s) failed:\\n\\n`\n\n    for (const step of failedSteps) {\n      comment += `#### ‚ùå Step: \\`${step.name}\\`\\n\\n`\n      comment += `**Status:** ${step.conclusion}\\n`\n\n      if (step.exitCode) {\n        comment += `**Exit Code:** ${step.exitCode}\\n`\n      }\n\n      comment += '\\n'\n\n      if (step.stdout) {\n        const truncatedStdout = truncateOutput(step.stdout, MAX_OUTPUT_PER_STEP)\n        comment += `<details>\\n<summary>üìÑ Output</summary>\\n\\n\\`\\`\\`\\n${truncatedStdout}\\n\\`\\`\\`\\n</details>\\n\\n`\n      }\n\n      if (step.stderr) {\n        const truncatedStderr = truncateOutput(step.stderr, MAX_OUTPUT_PER_STEP)\n        comment += `<details>\\n<summary>‚ö†Ô∏è Errors</summary>\\n\\n\\`\\`\\`\\n${truncatedStderr}\\n\\`\\`\\`\\n</details>\\n\\n`\n      }\n    }\n  }\n\n  // Final safety check\n  if (comment.length > MAX_COMMENT_SIZE) {\n    const availableSpace = MAX_COMMENT_SIZE - COMMENT_TRUNCATION_BUFFER\n    comment =\n      comment.substring(0, availableSpace) + '\\n\\n... [comment truncated] ...\\n'\n  }\n\n  return comment\n}\n\nexport function getWorkspaceMarker(workspace: string): string {\n  return `<!-- tf-report-action:${workspace} -->`\n}\n\nasync function run(): Promise<void> {\n  try {\n    const stepsInput = getInput('steps')\n    const workspace = getInput('workspace')\n    const token = getInput('github-token')\n\n    if (!stepsInput) {\n      setFailed('steps input is required')\n      return\n    }\n\n    if (!workspace) {\n      setFailed('workspace input is required')\n      return\n    }\n\n    if (!token) {\n      setFailed('github-token input is required')\n      return\n    }\n\n    let steps: Steps\n    try {\n      steps = JSON.parse(stepsInput)\n    } catch (error) {\n      setFailed(\n        `Failed to parse steps input as JSON: ${error instanceof Error ? error.message : 'Unknown error'}`\n      )\n      return\n    }\n\n    console.log(\n      `Analyzing ${Object.keys(steps).length} steps for workspace: ${workspace}`\n    )\n\n    const analysis = analyzeSteps(steps)\n\n    console.log(\n      `Analysis complete: ${analysis.success ? 'Success' : `Failed (${analysis.failedSteps.length} failures)`}`\n    )\n\n    const context = {\n      repo: process.env.GITHUB_REPOSITORY || '',\n      eventName: process.env.GITHUB_EVENT_NAME || ''\n    }\n\n    if (!context.repo) {\n      console.log('GITHUB_REPOSITORY not set, skipping comment')\n      return\n    }\n\n    const repoParts = context.repo.split('/')\n    if (repoParts.length !== 2) {\n      console.log(\n        `Invalid GITHUB_REPOSITORY format: ${context.repo}, skipping comment`\n      )\n      return\n    }\n\n    const [owner, repo] = repoParts\n\n    let issueNumber: number | undefined\n\n    if (\n      context.eventName === 'pull_request' ||\n      context.eventName === 'pull_request_target'\n    ) {\n      const eventPath = process.env.GITHUB_EVENT_PATH\n      if (eventPath) {\n        try {\n          const event = JSON.parse(fs.readFileSync(eventPath, 'utf8'))\n          issueNumber = event.pull_request?.number\n        } catch (error) {\n          console.log(\n            `Failed to read GitHub event file: ${error instanceof Error ? error.message : 'Unknown error'}`\n          )\n        }\n      }\n    }\n\n    if (!issueNumber) {\n      console.log('Not a pull request event, skipping comment')\n      return\n    }\n\n    const commentBody = generateCommentBody(workspace, analysis)\n    const marker = getWorkspaceMarker(workspace)\n\n    console.log(`Comment body length: ${commentBody.length} characters`)\n\n    const existingComments = await getExistingComments(\n      token,\n      repo,\n      owner,\n      issueNumber\n    )\n\n    for (const comment of existingComments) {\n      if (comment.body && comment.body.includes(marker)) {\n        console.log(`Deleting previous comment for workspace: ${workspace}`)\n        await deleteComment(token, repo, owner, comment.id)\n      }\n    }\n\n    console.log(`Posting new comment for workspace: ${workspace}`)\n    await postComment(token, repo, owner, issueNumber, commentBody)\n\n    console.log('Comment posted successfully')\n  } catch (error) {\n    if (error instanceof Error) {\n      setFailed(error.message)\n    } else {\n      setFailed('An unknown error occurred')\n    }\n  }\n}\n\n// Run the action if this is the main module\nif (\n  import.meta.url === `file://${process.argv[1]}` ||\n  import.meta.url.endsWith(process.argv[1])\n) {\n  run()\n}\n"],"names":[],"mappings":"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"}