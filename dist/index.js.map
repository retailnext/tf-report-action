{"version":3,"file":"index.js","sources":["../src/jsonlines.ts","../src/github.ts","../src/index.ts"],"sourcesContent":["/**\n * OpenTofu/Terraform JSON Lines Output Parser\n *\n * Implements parsing and formatting of machine-readable JSON output as documented at:\n * https://opentofu.org/docs/internals/machine-readable-ui/\n *\n * DOCUMENTATION SOURCE (for future updates):\n * https://github.com/opentofu/opentofu/blob/main/website/docs/internals/machine-readable-ui.mdx\n *\n * This module defines TypeScript interfaces for all message types and provides\n * functions to detect, parse, and format JSON Lines output from OpenTofu/Terraform\n * commands run with the -json flag.\n */\n\nimport { Readable } from 'stream'\n\n/**\n * Diagnostic detail for stream formatting\n */\ninterface DiagnosticDetail {\n  severity: 'error' | 'warning'\n  summary: string\n  detail?: string\n  filename?: string\n  line?: number\n  code?: string\n}\n\n/**\n * Change detail for stream formatting\n */\ninterface ChangeDetail {\n  action: string\n  addr: string\n}\n\n/**\n * Base interface for all JSON messages\n */\ninterface BaseMessage {\n  '@level': 'info' | 'warn' | 'error'\n  '@message': string\n  '@module': string\n  '@timestamp': string\n  type: string\n}\n\n/**\n * Version message - indicates the version of the JSON format\n */\nexport interface VersionMessage extends BaseMessage {\n  type: 'version'\n  tofu: string\n  ui: string\n}\n\n/**\n * Log message - unstructured human-readable log lines\n */\nexport interface LogMessage extends BaseMessage {\n  type: 'log'\n}\n\n/**\n * Diagnostic message - errors, warnings, and info messages\n */\nexport interface DiagnosticMessage extends BaseMessage {\n  type: 'diagnostic'\n  diagnostic: {\n    severity: 'error' | 'warning' | 'info'\n    summary: string\n    detail: string\n    range?: {\n      filename: string\n      start: { line: number; column: number; byte: number }\n      end: { line: number; column: number; byte: number }\n    }\n    snippet?: {\n      context?: string\n      code: string\n      start_line: number\n      highlight_start_offset: number\n      highlight_end_offset: number\n      values?: Array<{ traversal: string; statement: string }>\n    }\n  }\n}\n\n/**\n * Resource drift message - resources that have changed outside of Terraform\n */\nexport interface ResourceDriftMessage extends BaseMessage {\n  type: 'resource_drift'\n  change: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | null\n    }\n    action: 'update' | 'delete' | 'create' | 'read' | 'noop'\n  }\n}\n\n/**\n * Planned change message - describes a change that will be made\n */\nexport interface PlannedChangeMessage extends BaseMessage {\n  type: 'planned_change'\n  change: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    previous_resource?: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    action:\n      | 'noop'\n      | 'create'\n      | 'read'\n      | 'update'\n      | 'replace'\n      | 'delete'\n      | 'move'\n    reason?:\n      | 'tainted'\n      | 'requested'\n      | 'cannot_update'\n      | 'delete_because_no_resource_config'\n      | 'delete_because_wrong_repetition'\n      | 'delete_because_count_index'\n      | 'delete_because_each_key'\n      | 'delete_because_no_module'\n  }\n  prior_state?: unknown\n  config?: unknown\n}\n\n/**\n * Change summary message - summarizes the changes that will be made\n */\nexport interface ChangeSummaryMessage extends BaseMessage {\n  type: 'change_summary'\n  changes: {\n    add: number\n    change: number\n    remove: number\n    import: number\n    operation: 'plan' | 'apply' | 'destroy'\n  }\n}\n\n/**\n * Outputs message - shows output values\n */\nexport interface OutputsMessage extends BaseMessage {\n  type: 'outputs'\n  outputs: {\n    [key: string]: {\n      sensitive: boolean\n      type: string | string[]\n      value: unknown\n    }\n  }\n}\n\n/**\n * Apply start message\n */\nexport interface ApplyStartMessage extends BaseMessage {\n  type: 'apply_start'\n  hook: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    action: string\n    id_key?: string\n    id_value?: string\n  }\n}\n\n/**\n * Apply progress message\n */\nexport interface ApplyProgressMessage extends BaseMessage {\n  type: 'apply_progress'\n  hook: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    action: string\n    elapsed_seconds: number\n  }\n}\n\n/**\n * Apply complete message\n */\nexport interface ApplyCompleteMessage extends BaseMessage {\n  type: 'apply_complete'\n  hook: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    action: string\n    id_key?: string\n    id_value?: string\n    elapsed_seconds: number\n  }\n}\n\n/**\n * Apply errored message\n */\nexport interface ApplyErroredMessage extends BaseMessage {\n  type: 'apply_errored'\n  hook: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    action: string\n  }\n}\n\n/**\n * Provision start message\n */\nexport interface ProvisionStartMessage extends BaseMessage {\n  type: 'provision_start'\n  hook: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    provisioner: string\n  }\n}\n\n/**\n * Provision progress message\n */\nexport interface ProvisionProgressMessage extends BaseMessage {\n  type: 'provision_progress'\n  hook: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    provisioner: string\n    output: string\n  }\n}\n\n/**\n * Provision complete message\n */\nexport interface ProvisionCompleteMessage extends BaseMessage {\n  type: 'provision_complete'\n  hook: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    provisioner: string\n  }\n}\n\n/**\n * Provision errored message\n */\nexport interface ProvisionErroredMessage extends BaseMessage {\n  type: 'provision_errored'\n  hook: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    provisioner: string\n  }\n}\n\n/**\n * Refresh start message\n */\nexport interface RefreshStartMessage extends BaseMessage {\n  type: 'refresh_start'\n  hook: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    id_key?: string\n    id_value?: string\n  }\n}\n\n/**\n * Refresh complete message\n */\nexport interface RefreshCompleteMessage extends BaseMessage {\n  type: 'refresh_complete'\n  hook: {\n    resource: {\n      addr: string\n      module: string\n      resource: string\n      implied_provider: string\n      resource_type: string\n      resource_name: string\n      resource_key: string | number | null\n    }\n    id_key?: string\n    id_value?: string\n  }\n}\n\n/**\n * Test abstract message - summary of test files and tests found\n */\nexport interface TestAbstractMessage extends BaseMessage {\n  type: 'test_abstract'\n  test_abstract: {\n    [filename: string]: string[]\n  }\n}\n\n/**\n * Test file message - summary of test file execution\n */\nexport interface TestFileMessage extends BaseMessage {\n  type: 'test_file'\n  test_file: {\n    path: string\n    status: string\n  }\n}\n\n/**\n * Test run message - summary of test execution\n */\nexport interface TestRunMessage extends BaseMessage {\n  type: 'test_run'\n  test_run: {\n    path: string\n    run: string\n    status: string\n  }\n}\n\n/**\n * Test summary message - summary of overall test file execution\n */\nexport interface TestSummaryMessage extends BaseMessage {\n  type: 'test_summary'\n  test_summary: {\n    status: string\n    passed: number\n    failed: number\n    errored: number\n    skipped: number\n  }\n}\n\n/**\n * Union type of all message types\n */\nexport type JsonLineMessage =\n  | VersionMessage\n  | LogMessage\n  | DiagnosticMessage\n  | ResourceDriftMessage\n  | PlannedChangeMessage\n  | ChangeSummaryMessage\n  | OutputsMessage\n  | ApplyStartMessage\n  | ApplyProgressMessage\n  | ApplyCompleteMessage\n  | ApplyErroredMessage\n  | ProvisionStartMessage\n  | ProvisionProgressMessage\n  | ProvisionCompleteMessage\n  | ProvisionErroredMessage\n  | RefreshStartMessage\n  | RefreshCompleteMessage\n  | TestAbstractMessage\n  | TestFileMessage\n  | TestRunMessage\n  | TestSummaryMessage\n\n/**\n * Check if a stream appears to be JSON Lines format by checking first few lines.\n * Does not accumulate data beyond what's needed for detection.\n */\nexport async function isJsonLines(\n  stream: Readable | undefined\n): Promise<boolean> {\n  if (!stream) {\n    return false\n  }\n\n  let buffer = ''\n  let linesChecked = 0\n  let validJsonCount = 0\n  const samplesToCheck = 3\n\n  return new Promise((resolve) => {\n    stream.on('data', (chunk) => {\n      buffer += typeof chunk === 'string' ? chunk : chunk.toString('utf8')\n\n      // Process complete lines\n      let newlineIndex\n      while (\n        (newlineIndex = buffer.indexOf('\\n')) !== -1 &&\n        linesChecked < samplesToCheck\n      ) {\n        const line = buffer.substring(0, newlineIndex).trim()\n        buffer = buffer.substring(newlineIndex + 1)\n\n        if (!line) continue\n\n        linesChecked++\n\n        try {\n          const parsed = JSON.parse(line)\n          // Check for required fields in OpenTofu/Terraform JSON output\n          if (\n            parsed &&\n            typeof parsed === 'object' &&\n            'type' in parsed &&\n            '@message' in parsed\n          ) {\n            validJsonCount++\n          }\n        } catch {\n          // Not valid JSON, continue checking other lines\n        }\n\n        if (linesChecked >= samplesToCheck) {\n          stream.destroy()\n          resolve(validJsonCount > 0)\n          return\n        }\n      }\n    })\n\n    stream.on('end', () => {\n      resolve(validJsonCount > 0)\n    })\n\n    stream.on('error', () => {\n      resolve(false)\n    })\n  })\n}\n\n/**\n * Get emoji for a change action\n */\nfunction getActionEmoji(\n  action: string\n):\n  | ':heavy_plus_sign:'\n  | 'üîÑ'\n  | ':heavy_minus_sign:'\n  | '¬±'\n  | 'üìñ'\n  | 'üöö'\n  | '‚ö™' {\n  switch (action) {\n    case 'create':\n      return ':heavy_plus_sign:'\n    case 'update':\n      return 'üîÑ'\n    case 'delete':\n    case 'remove':\n      return ':heavy_minus_sign:'\n    case 'replace':\n      return '¬±'\n    case 'read':\n      return 'üìñ'\n    case 'move':\n      return 'üöö'\n    case 'noop':\n    default:\n      return '‚ö™'\n  }\n}\n\n/**\n * Format JSON Lines from a stream directly without accumulating messages.\n * Limits based on formatted output size, not message count.\n * Stops accumulating when formatted output reaches size limit.\n */\nexport async function formatJsonLines(\n  stream: Readable | undefined,\n  maxOutputSize: number = 20000\n): Promise<string> {\n  if (!stream) {\n    return ''\n  }\n\n  // Reserves space for important summaries. Always includes change_summary which may appear at end of stream.\n  const SUMMARY_RESERVE_CHARS = 1000\n  const effectiveLimit = maxOutputSize - SUMMARY_RESERVE_CHARS\n\n  let buffer = ''\n\n  // Build output incrementally, checking size as we go\n  let formattedOutput = ''\n\n  // Accumulate only important details temporarily for formatting\n  const errorDetails: DiagnosticDetail[] = []\n  const warningDetails: DiagnosticDetail[] = []\n  const plannedChangeDetails: ChangeDetail[] = []\n  const applyCompleteDetails: ChangeDetail[] = []\n  const driftDetails: ChangeDetail[] = []\n\n  // Single values\n  let changeSummaryMessage: string | undefined\n  let operationType: 'plan' | 'apply' | 'destroy' | 'unknown' = 'unknown'\n\n  // Helper function to process a single parsed JSON message\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const processMessage = (parsed: any) => {\n    switch (parsed.type) {\n      case 'diagnostic':\n        if (parsed.diagnostic) {\n          const detail: DiagnosticDetail = {\n            severity: parsed.diagnostic.severity,\n            summary: parsed.diagnostic.summary,\n            detail: parsed.diagnostic.detail,\n            filename: parsed.diagnostic.range?.filename,\n            line: parsed.diagnostic.range?.start?.line,\n            code: parsed.diagnostic.snippet?.code\n          }\n\n          if (detail.severity === 'error') {\n            errorDetails.push(detail)\n          } else if (detail.severity === 'warning') {\n            warningDetails.push(detail)\n          }\n        }\n        break\n\n      case 'change_summary':\n        changeSummaryMessage = parsed['@message']\n        if (parsed.changes) {\n          operationType = parsed.changes.operation || 'unknown'\n        }\n        break\n\n      case 'planned_change':\n        if (parsed.change) {\n          const resource = parsed.change.resource\n          plannedChangeDetails.push({\n            action: parsed.change.action,\n            addr:\n              resource?.addr ||\n              `${resource?.resource_type}.${resource?.resource_name}`\n          })\n        }\n        break\n\n      case 'apply_complete':\n        if (parsed.hook) {\n          const resource = parsed.hook.resource\n          applyCompleteDetails.push({\n            action: parsed.hook.action,\n            addr:\n              resource?.addr ||\n              `${resource?.resource_type}.${resource?.resource_name}`\n          })\n        }\n        break\n\n      case 'resource_drift':\n        if (parsed.change) {\n          const resource = parsed.change.resource\n          driftDetails.push({\n            action: parsed.change.action,\n            addr:\n              resource?.addr ||\n              `${resource?.resource_type}.${resource?.resource_name}`\n          })\n        }\n        break\n    }\n  }\n\n  return new Promise((resolve) => {\n    stream.on('data', (chunk) => {\n      buffer += typeof chunk === 'string' ? chunk : chunk.toString('utf8')\n\n      // Process complete lines\n      let newlineIndex\n      while ((newlineIndex = buffer.indexOf('\\n')) !== -1) {\n        const line = buffer.substring(0, newlineIndex).trim()\n        buffer = buffer.substring(newlineIndex + 1)\n\n        if (!line) continue\n\n        try {\n          const parsed = JSON.parse(line)\n          processMessage(parsed)\n        } catch {\n          // Skip lines that aren't valid JSON\n        }\n      }\n    })\n\n    stream.on('end', () => {\n      // Process any remaining buffer content (last line without trailing newline)\n      if (buffer.trim()) {\n        try {\n          const parsed = JSON.parse(buffer)\n          processMessage(parsed)\n        } catch {\n          // Skip if final buffer isn't valid JSON\n        }\n      }\n\n      formattedOutput = buildFormattedOutput(\n        changeSummaryMessage,\n        operationType,\n        errorDetails,\n        warningDetails,\n        plannedChangeDetails,\n        applyCompleteDetails,\n        driftDetails,\n        effectiveLimit\n      )\n      resolve(formattedOutput)\n    })\n\n    stream.on('error', () => {\n      formattedOutput = buildFormattedOutput(\n        changeSummaryMessage,\n        operationType,\n        errorDetails,\n        warningDetails,\n        plannedChangeDetails,\n        applyCompleteDetails,\n        driftDetails,\n        effectiveLimit\n      )\n      resolve(formattedOutput)\n    })\n  })\n}\n\n/**\n * Build formatted output from accumulated details, limiting by output size\n */\nfunction buildFormattedOutput(\n  changeSummaryMessage: string | undefined,\n  operationType: 'plan' | 'apply' | 'destroy' | 'unknown',\n  errorDetails: DiagnosticDetail[],\n  warningDetails: DiagnosticDetail[],\n  plannedChangeDetails: ChangeDetail[],\n  applyCompleteDetails: ChangeDetail[],\n  driftDetails: ChangeDetail[],\n  maxSize?: number\n): string {\n  let result = ''\n\n  // Show change summary first\n  if (changeSummaryMessage) {\n    result += `${changeSummaryMessage}\\n\\n`\n  }\n\n  // Format diagnostics, checking size as we add each one\n  if (errorDetails.length > 0) {\n    let diagnosticsSection = '<details>\\n<summary>‚ùå Errors</summary>\\n\\n'\n    let errorCount = 0\n\n    for (const err of errorDetails) {\n      const errorText =\n        `‚ùå **${err.summary}**` +\n        (err.detail ? `\\n\\n${err.detail}` : '') +\n        (err.filename && err.line\n          ? `\\n\\nüìÑ \\`${err.filename}:${err.line}\\``\n          : '') +\n        (err.code ? '\\n\\n```hcl\\n' + err.code + '\\n```' : '') +\n        '\\n\\n'\n\n      if (\n        maxSize &&\n        (result + diagnosticsSection + errorText).length > maxSize\n      ) {\n        break\n      }\n      diagnosticsSection += errorText\n      errorCount++\n    }\n\n    if (errorCount < errorDetails.length) {\n      diagnosticsSection += `... (showing ${errorCount} of ${errorDetails.length} errors)\\n\\n`\n    }\n    diagnosticsSection += '</details>\\n\\n'\n\n    if (!maxSize || (result + diagnosticsSection).length <= maxSize) {\n      result += diagnosticsSection\n    }\n  }\n\n  if (warningDetails.length > 0 && (!maxSize || result.length < maxSize)) {\n    let diagnosticsSection = '<details>\\n<summary>‚ö†Ô∏è Warnings</summary>\\n\\n'\n    let warnCount = 0\n\n    for (const warn of warningDetails) {\n      const warnText =\n        `‚ö†Ô∏è **${warn.summary}**` +\n        (warn.detail ? `\\n\\n${warn.detail}` : '') +\n        (warn.filename && warn.line\n          ? `\\n\\nüìÑ \\`${warn.filename}:${warn.line}\\``\n          : '') +\n        (warn.code ? '\\n\\n```hcl\\n' + warn.code + '\\n```' : '') +\n        '\\n\\n'\n\n      if (\n        maxSize &&\n        (result + diagnosticsSection + warnText).length > maxSize\n      ) {\n        break\n      }\n      diagnosticsSection += warnText\n      warnCount++\n    }\n\n    if (warnCount < warningDetails.length) {\n      diagnosticsSection += `... (showing ${warnCount} of ${warningDetails.length} warnings)\\n\\n`\n    }\n    diagnosticsSection += '</details>\\n\\n'\n\n    if (!maxSize || (result + diagnosticsSection).length <= maxSize) {\n      result += diagnosticsSection\n    }\n  }\n\n  // Format changes, checking size\n  const hasChanges =\n    plannedChangeDetails.length > 0 || applyCompleteDetails.length > 0\n\n  if (hasChanges && (!maxSize || result.length < maxSize)) {\n    if (operationType === 'plan' && plannedChangeDetails.length > 0) {\n      let changesSection =\n        '<details>\\n<summary>üìã Planned Changes</summary>\\n\\n'\n      let changeCount = 0\n\n      for (const change of plannedChangeDetails) {\n        const emoji = getActionEmoji(change.action)\n        const changeText = `${emoji} **${change.addr}** (${change.action})\\n`\n\n        if (\n          maxSize &&\n          (result + changesSection + changeText).length > maxSize\n        ) {\n          break\n        }\n        changesSection += changeText\n        changeCount++\n      }\n\n      if (changeCount < plannedChangeDetails.length) {\n        changesSection += `\\n... (showing ${changeCount} of ${plannedChangeDetails.length} changes)\\n`\n      }\n      changesSection += '\\n</details>\\n\\n'\n\n      if (!maxSize || (result + changesSection).length <= maxSize) {\n        result += changesSection\n      }\n    } else if (operationType === 'apply' && applyCompleteDetails.length > 0) {\n      let changesSection =\n        '<details>\\n<summary>‚úÖ Applied Changes</summary>\\n\\n'\n      let changeCount = 0\n\n      for (const change of applyCompleteDetails) {\n        const emoji = getActionEmoji(change.action)\n        const changeText = `${emoji} **${change.addr}** (${change.action})\\n`\n\n        if (\n          maxSize &&\n          (result + changesSection + changeText).length > maxSize\n        ) {\n          break\n        }\n        changesSection += changeText\n        changeCount++\n      }\n\n      if (changeCount < applyCompleteDetails.length) {\n        changesSection += `\\n... (showing ${changeCount} of ${applyCompleteDetails.length} changes)\\n`\n      }\n      changesSection += '\\n</details>\\n\\n'\n\n      if (!maxSize || (result + changesSection).length <= maxSize) {\n        result += changesSection\n      }\n    } else if (operationType === 'unknown' && plannedChangeDetails.length > 0) {\n      let changesSection =\n        '<details>\\n<summary>üìã Planned Changes</summary>\\n\\n'\n      let changeCount = 0\n\n      for (const change of plannedChangeDetails) {\n        const emoji = getActionEmoji(change.action)\n        const changeText = `${emoji} **${change.addr}** (${change.action})\\n`\n\n        if (\n          maxSize &&\n          (result + changesSection + changeText).length > maxSize\n        ) {\n          break\n        }\n        changesSection += changeText\n        changeCount++\n      }\n\n      if (changeCount < plannedChangeDetails.length) {\n        changesSection += `\\n... (showing ${changeCount} of ${plannedChangeDetails.length} changes)\\n`\n      }\n      changesSection += '\\n</details>\\n\\n'\n\n      if (!maxSize || (result + changesSection).length <= maxSize) {\n        result += changesSection\n      }\n    }\n  }\n\n  // Format drifts\n  if (driftDetails.length > 0 && (!maxSize || result.length < maxSize)) {\n    let driftsSection = '<details>\\n<summary>üîÄ Resource Drift</summary>\\n\\n'\n    let driftCount = 0\n\n    for (const drift of driftDetails) {\n      const emoji = getActionEmoji(drift.action)\n      const driftText = `${emoji} **${drift.addr}** (${drift.action})\\n`\n\n      if (maxSize && (result + driftsSection + driftText).length > maxSize) {\n        break\n      }\n      driftsSection += driftText\n      driftCount++\n    }\n\n    if (driftCount < driftDetails.length) {\n      driftsSection += `\\n... (showing ${driftCount} of ${driftDetails.length} drifts)\\n`\n    }\n    driftsSection += '\\n</details>\\n\\n'\n\n    if (!maxSize || (result + driftsSection).length <= maxSize) {\n      result += driftsSection\n    }\n  }\n\n  return result.trim()\n}\n","import * as https from 'https'\n\n// Type for the request function to allow dependency injection\nexport type HttpsRequestFn = typeof https.request\n\n// Default implementation using the real https module\nlet requestImpl: HttpsRequestFn = https.request\n\n/**\n * Set a custom request implementation (for testing)\n * @internal\n */\nexport function _setRequestImpl(impl: HttpsRequestFn): void {\n  requestImpl = impl\n}\n\n/**\n * Reset to the default request implementation\n * @internal\n */\nexport function _resetRequestImpl(): void {\n  requestImpl = https.request\n}\n\n/**\n * Make an HTTPS request to the GitHub API\n */\nexport async function httpsRequest(\n  options: https.RequestOptions,\n  data?: string\n): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const req = requestImpl(options, (res) => {\n      const chunks: Buffer[] = []\n      res.on('data', (chunk) => chunks.push(chunk))\n      res.on('end', () => {\n        const body = Buffer.concat(chunks).toString('utf8')\n        if (res.statusCode && res.statusCode >= 200 && res.statusCode < 300) {\n          resolve(body)\n        } else {\n          reject(new Error(`HTTP ${res.statusCode}: ${body}`))\n        }\n      })\n    })\n    req.on('error', reject)\n    if (data) {\n      req.write(data)\n    }\n    req.end()\n  })\n}\n\n/**\n * Get existing comments on an issue or pull request\n */\nexport async function getExistingComments(\n  token: string,\n  repo: string,\n  owner: string,\n  issueNumber: number\n): Promise<Array<{ id: number; body: string }>> {\n  const options: https.RequestOptions = {\n    hostname: 'api.github.com',\n    path: `/repos/${owner}/${repo}/issues/${issueNumber}/comments`,\n    method: 'GET',\n    headers: {\n      Authorization: `Bearer ${token}`,\n      'User-Agent': 'tf-report-action',\n      Accept: 'application/vnd.github+json'\n    }\n  }\n\n  const response = await httpsRequest(options)\n  return JSON.parse(response)\n}\n\n/**\n * Delete a comment from an issue or pull request\n */\nexport async function deleteComment(\n  token: string,\n  repo: string,\n  owner: string,\n  commentId: number\n): Promise<void> {\n  const options: https.RequestOptions = {\n    hostname: 'api.github.com',\n    path: `/repos/${owner}/${repo}/issues/comments/${commentId}`,\n    method: 'DELETE',\n    headers: {\n      Authorization: `Bearer ${token}`,\n      'User-Agent': 'tf-report-action',\n      Accept: 'application/vnd.github+json'\n    }\n  }\n\n  await httpsRequest(options)\n}\n\n/**\n * Post a comment to an issue or pull request\n */\nexport async function postComment(\n  token: string,\n  repo: string,\n  owner: string,\n  issueNumber: number,\n  body: string\n): Promise<void> {\n  const options: https.RequestOptions = {\n    hostname: 'api.github.com',\n    path: `/repos/${owner}/${repo}/issues/${issueNumber}/comments`,\n    method: 'POST',\n    headers: {\n      Authorization: `Bearer ${token}`,\n      'User-Agent': 'tf-report-action',\n      Accept: 'application/vnd.github+json',\n      'Content-Type': 'application/json'\n    }\n  }\n\n  const payload = JSON.stringify({ body })\n  await httpsRequest(options, payload)\n}\n\n/**\n * Search for issues in a repository\n */\nexport async function searchIssues(\n  token: string,\n  repo: string,\n  owner: string,\n  query: string\n): Promise<Array<{ number: number; title: string; body: string }>> {\n  const encodedQuery = encodeURIComponent(query)\n  const options: https.RequestOptions = {\n    hostname: 'api.github.com',\n    path: `/search/issues?q=${encodedQuery}`,\n    method: 'GET',\n    headers: {\n      Authorization: `Bearer ${token}`,\n      'User-Agent': 'tf-report-action',\n      Accept: 'application/vnd.github+json'\n    }\n  }\n\n  const response = await httpsRequest(options)\n  try {\n    const result = JSON.parse(response)\n    return result.items || []\n  } catch (error) {\n    throw new Error(\n      `Failed to parse search issues response: ${(error as Error).message}`\n    )\n  }\n}\n\n/**\n * Create a new issue\n */\nexport async function createIssue(\n  token: string,\n  repo: string,\n  owner: string,\n  title: string,\n  body: string\n): Promise<number> {\n  const options: https.RequestOptions = {\n    hostname: 'api.github.com',\n    path: `/repos/${owner}/${repo}/issues`,\n    method: 'POST',\n    headers: {\n      Authorization: `Bearer ${token}`,\n      'User-Agent': 'tf-report-action',\n      Accept: 'application/vnd.github+json',\n      'Content-Type': 'application/json'\n    }\n  }\n\n  const payload = JSON.stringify({ title, body })\n  const response = await httpsRequest(options, payload)\n  try {\n    const issue = JSON.parse(response)\n    if (!issue.number) {\n      throw new Error('API response missing issue number')\n    }\n    return issue.number\n  } catch (error) {\n    throw new Error(\n      `Failed to parse create issue response: ${(error as Error).message}`\n    )\n  }\n}\n\n/**\n * Update an existing issue\n */\nexport async function updateIssue(\n  token: string,\n  repo: string,\n  owner: string,\n  issueNumber: number,\n  title: string,\n  body: string\n): Promise<void> {\n  const options: https.RequestOptions = {\n    hostname: 'api.github.com',\n    path: `/repos/${owner}/${repo}/issues/${issueNumber}`,\n    method: 'PATCH',\n    headers: {\n      Authorization: `Bearer ${token}`,\n      'User-Agent': 'tf-report-action',\n      Accept: 'application/vnd.github+json',\n      'Content-Type': 'application/json'\n    }\n  }\n\n  const payload = JSON.stringify({ title, body })\n  await httpsRequest(options, payload)\n}\n","import * as fs from 'fs'\nimport { Readable } from 'stream'\nimport { isJsonLines, formatJsonLines } from './jsonlines.js'\nimport {\n  getExistingComments,\n  deleteComment,\n  postComment,\n  searchIssues,\n  createIssue,\n  updateIssue\n} from './github.js'\n\n// Re-export jsonlines functions for use by scripts and tests\nexport { isJsonLines, formatJsonLines }\n\n// Month names for timestamp formatting\nconst MONTH_NAMES = [\n  'January',\n  'February',\n  'March',\n  'April',\n  'May',\n  'June',\n  'July',\n  'August',\n  'September',\n  'October',\n  'November',\n  'December'\n]\n\ninterface StepData {\n  conclusion?: string\n  outcome?: string\n  outputs?: {\n    stdout?: string\n    stderr?: string\n    stdout_file?: string\n    stderr_file?: string\n    exit_code?: string\n    [key: string]: unknown\n  }\n}\n\ninterface Steps {\n  [key: string]: StepData\n}\n\n/**\n * Provides lazy access to step output streams.\n * Avoids eagerly reading large outputs into memory.\n */\nexport class StepOutputs {\n  constructor(\n    private readonly outputs: StepData['outputs'],\n    private readonly exitCode?: string\n  ) {}\n\n  /**\n   * Get a readable stream for stdout.\n   * Returns a fresh stream each time.\n   */\n  getStdoutStream(): Readable | undefined {\n    return getStepOutputStream(this.outputs, 'stdout')\n  }\n\n  /**\n   * Get a readable stream for stderr.\n   * Returns a fresh stream each time.\n   */\n  getStderrStream(): Readable | undefined {\n    return getStepOutputStream(this.outputs, 'stderr')\n  }\n\n  /**\n   * Get the exit code\n   */\n  getExitCode(): string | undefined {\n    return this.exitCode\n  }\n}\n\ninterface StepFailure {\n  name: string\n  conclusion: string\n  outputs: StepOutputs\n}\n\ninterface AnalysisResult {\n  success: boolean\n  failedSteps: StepFailure[]\n  totalSteps: number\n  successfulSteps: number\n  skippedSteps: number\n  targetStepResult?: {\n    name: string\n    found: boolean\n    conclusion?: string\n    outputs?: StepOutputs\n    isJsonLines?: boolean\n    operationType?: 'plan' | 'apply' | 'destroy' | 'unknown'\n    hasChanges?: boolean\n    hasErrors?: boolean\n    changeSummaryMessage?: string\n  }\n}\n\n// GitHub comment max size is 65536 characters\nconst MAX_COMMENT_SIZE = 60000\nconst MAX_OUTPUT_PER_STEP = 20000\nconst COMMENT_TRUNCATION_BUFFER = 1000\n\n/**\n * Get a readable stream for step output data, supporting both file-based and direct outputs.\n * This is file-centric: file paths are used directly, while direct outputs are wrapped\n * in a Readable stream shim for consistent handling.\n */\nexport function getStepOutputStream(\n  stepOutputs: StepData['outputs'],\n  outputType: 'stdout' | 'stderr'\n): Readable | undefined {\n  if (!stepOutputs) {\n    return undefined\n  }\n\n  // Check for file-based output first (primary/expected format)\n  const fileOutputKey =\n    outputType === 'stdout'\n      ? ('stdout_file' as const)\n      : ('stderr_file' as const)\n  const filePath = stepOutputs[fileOutputKey] as string | undefined\n\n  if (filePath) {\n    // Return a readable stream from the file\n    try {\n      return fs.createReadStream(filePath, { encoding: 'utf8' })\n    } catch (error) {\n      console.error(\n        `Failed to create read stream for ${outputType} from file ${filePath}: ${error instanceof Error ? error.message : 'Unknown error'}`\n      )\n      return undefined\n    }\n  }\n\n  // Fall back to direct output (legacy format) - wrap in Readable stream\n  const directOutput = stepOutputs[outputType] as string | undefined\n  if (directOutput !== undefined) {\n    return Readable.from([directOutput])\n  }\n\n  return undefined\n}\n\n/**\n * Analyze a JSON Lines stream incrementally, extracting only metadata.\n * Processes messages one at a time without accumulating them.\n */\nasync function analyzeJsonLines(stream: Readable | undefined): Promise<{\n  isJsonLines: boolean\n  operationType: 'plan' | 'apply' | 'destroy' | 'unknown'\n  hasChanges: boolean\n  hasErrors: boolean\n  changeSummaryMessage?: string\n}> {\n  if (!stream) {\n    return {\n      isJsonLines: false,\n      operationType: 'unknown',\n      hasChanges: false,\n      hasErrors: false\n    }\n  }\n\n  let operationType: 'plan' | 'apply' | 'destroy' | 'unknown' = 'unknown'\n  let hasChanges = false\n  let hasErrors = false\n  let changeSummaryMessage: string | undefined\n  let buffer = ''\n  let foundJsonLine = false\n\n  return new Promise((resolve) => {\n    stream.on('data', (chunk) => {\n      buffer += typeof chunk === 'string' ? chunk : chunk.toString('utf8')\n\n      // Process complete lines\n      let newlineIndex\n      while ((newlineIndex = buffer.indexOf('\\n')) !== -1) {\n        const line = buffer.substring(0, newlineIndex).trim()\n        buffer = buffer.substring(newlineIndex + 1)\n\n        if (!line) continue\n\n        try {\n          const parsed = JSON.parse(line)\n          foundJsonLine = true\n\n          // Extract metadata from JSON Lines messages\n          // Process one message at a time without accumulation\n          if (parsed.type === 'diagnostic' && parsed['@level'] === 'error') {\n            hasErrors = true\n          }\n\n          if (parsed.type === 'change_summary') {\n            const changes = parsed.changes || {}\n            operationType = changes.operation || 'unknown'\n            changeSummaryMessage = parsed['@message']\n            const {\n              add = 0,\n              change: chg = 0,\n              remove = 0,\n              import: imp = 0\n            } = changes\n            hasChanges = add > 0 || chg > 0 || remove > 0 || imp > 0\n          }\n        } catch {\n          // Not JSON, ignore\n        }\n      }\n    })\n\n    stream.on('end', () => {\n      resolve({\n        isJsonLines: foundJsonLine,\n        operationType,\n        hasChanges,\n        hasErrors,\n        changeSummaryMessage\n      })\n    })\n\n    stream.on('error', () => {\n      resolve({\n        isJsonLines: foundJsonLine,\n        operationType,\n        hasChanges,\n        hasErrors,\n        changeSummaryMessage\n      })\n    })\n  })\n}\n\n/**\n * Read limited content from a stream for comment/status message assembly.\n * Reads incrementally with size limit to avoid unbounded memory usage.\n */\nasync function readLimitedStreamContent(\n  stream: Readable | undefined,\n  maxBytes: number\n): Promise<string> {\n  if (!stream) {\n    return ''\n  }\n\n  const chunks: string[] = []\n  let totalLength = 0\n\n  return new Promise((resolve) => {\n    stream.on('data', (chunk) => {\n      const chunkStr =\n        typeof chunk === 'string' ? chunk : chunk.toString('utf8')\n      const chunkLength = Buffer.byteLength(chunkStr, 'utf8')\n\n      if (totalLength + chunkLength <= maxBytes) {\n        chunks.push(chunkStr)\n        totalLength += chunkLength\n      } else {\n        // Reached limit, take only what fits\n        const remaining = maxBytes - totalLength\n        if (remaining > 0) {\n          chunks.push(chunkStr.substring(0, remaining))\n        }\n        stream.destroy() // Stop reading\n        resolve(chunks.join(''))\n      }\n    })\n\n    stream.on('end', () => {\n      resolve(chunks.join(''))\n    })\n\n    stream.on('error', (error) => {\n      console.error(`Error reading stream: ${error.message}`)\n      resolve(chunks.join('')) // Return what we have\n    })\n  })\n}\n\n/**\n * Get an input value from the environment\n */\nexport function getInput(name: string): string {\n  const val =\n    process.env[`INPUT_${name.replace(/ /g, '_').toUpperCase()}`] || ''\n  return val.trim()\n}\n\n/**\n * Log an informational message\n */\nfunction info(message: string): void {\n  console.log(message)\n}\n\n/**\n * Set the action as failed and exit\n */\nexport function setFailed(message: string): void {\n  console.error(`::error::${message}`)\n  process.exit(1)\n}\n\n/**\n * Get the GitHub workflow run logs URL\n */\nexport function getJobLogsUrl(): string {\n  const repo = process.env.GITHUB_REPOSITORY || ''\n  const runId = process.env.GITHUB_RUN_ID || ''\n\n  if (repo && runId) {\n    const runAttempt = process.env.GITHUB_RUN_ATTEMPT || '1'\n    return `https://github.com/${repo}/actions/runs/${runId}/attempts/${runAttempt}`\n  }\n  return ''\n}\n\n/**\n * Format a date in a human-friendly format in UTC with 24-hour time\n * Example: \"January 22, 2026 at 19:05 UTC\"\n */\nexport function formatTimestamp(date: Date): string {\n  const month = MONTH_NAMES[date.getUTCMonth()]\n  const day = date.getUTCDate()\n  const year = date.getUTCFullYear()\n\n  const hours = date.getUTCHours()\n  const minutes = date.getUTCMinutes()\n\n  const hoursStr = hours < 10 ? `0${hours}` : `${hours}`\n  const minutesStr = minutes < 10 ? `0${minutes}` : `${minutes}`\n\n  return `${month} ${day}, ${year} at ${hoursStr}:${minutesStr} UTC`\n}\n\nexport function truncateOutput(\n  text: string,\n  maxLength: number,\n  includeLogLink = false\n): string {\n  if (text.length <= maxLength) return text\n\n  const logLink = includeLogLink ? getJobLogsUrl() : ''\n  const truncationMessage = logLink\n    ? `\\n\\n... [output truncated - [view full logs](${logLink})] ...\\n\\n`\n    : '\\n\\n... [output truncated] ...\\n\\n'\n  const availableLength = maxLength - truncationMessage.length\n\n  if (availableLength <= 0) {\n    return text.substring(0, maxLength)\n  }\n\n  const halfLength = Math.floor(availableLength / 2)\n  return (\n    text.substring(0, halfLength) +\n    truncationMessage +\n    text.substring(text.length - halfLength)\n  )\n}\n\nexport async function analyzeSteps(\n  steps: Steps,\n  targetStep?: string\n): Promise<AnalysisResult> {\n  const stepEntries = Object.entries(steps)\n  const totalSteps = stepEntries.length\n  const failedSteps: StepFailure[] = []\n  let successfulSteps = 0\n  let skippedSteps = 0\n  let targetStepResult\n\n  for (const [stepName, stepData] of stepEntries) {\n    // Use outcome instead of conclusion as per requirements\n    const outcome = stepData.outcome || stepData.conclusion || ''\n\n    // Check if this is the target step\n    if (targetStep && stepName === targetStep) {\n      const stepOutputs = new StepOutputs(\n        stepData.outputs,\n        stepData.outputs?.exit_code as string | undefined\n      )\n\n      // Analyze stdout stream incrementally for metadata only\n      const stdoutStream = stepOutputs.getStdoutStream()\n      const analysis = await analyzeJsonLines(stdoutStream)\n\n      targetStepResult = {\n        name: stepName,\n        found: true,\n        conclusion: outcome,\n        outputs: stepOutputs,\n        isJsonLines: analysis.isJsonLines,\n        operationType: analysis.operationType,\n        hasChanges: analysis.hasChanges,\n        hasErrors: analysis.hasErrors,\n        changeSummaryMessage: analysis.changeSummaryMessage\n      }\n    }\n\n    // Count step outcomes\n    if (outcome === 'success') {\n      successfulSteps++\n    } else if (outcome === 'skipped') {\n      skippedSteps++\n    } else if (outcome && outcome !== 'cancelled' && outcome !== 'neutral') {\n      // Treat as failure if not success, skipped, cancelled, or neutral\n      const failure: StepFailure = {\n        name: stepName,\n        conclusion: outcome,\n        outputs: new StepOutputs(\n          stepData.outputs,\n          stepData.outputs?.exit_code as string | undefined\n        )\n      }\n      failedSteps.push(failure)\n    }\n  }\n\n  // If target step was specified but not found\n  if (targetStep && !targetStepResult) {\n    targetStepResult = {\n      name: targetStep,\n      found: false\n    }\n  }\n\n  return {\n    success: failedSteps.length === 0,\n    failedSteps,\n    totalSteps,\n    successfulSteps,\n    skippedSteps,\n    targetStepResult\n  }\n}\n\nexport async function generateCommentBody(\n  workspace: string,\n  analysis: AnalysisResult,\n  includeLogLink = false,\n  timestamp?: Date\n): Promise<string> {\n  const {\n    success,\n    failedSteps,\n    totalSteps,\n    successfulSteps,\n    skippedSteps,\n    targetStepResult\n  } = analysis\n  const marker = `<!-- tf-report-action:\"${workspace}\" -->`\n  const title = generateTitle(workspace, analysis)\n\n  let comment = `${marker}\\n\\n## ${title}\\n\\n`\n\n  if (targetStepResult) {\n    // Target step focused comment\n    if (!targetStepResult.found) {\n      if (failedSteps.length > 0) {\n        // If there are failed steps, focus on reporting those failures\n        comment += `${failedSteps.length} of ${totalSteps} step(s) failed:\\n\\n`\n        for (const step of failedSteps) {\n          comment += `- ‚ùå \\`${step.name}\\` (${step.conclusion})\\n`\n        }\n      } else {\n        // Only mention step not found if no other failures\n        comment += `### Did Not Run\\n\\n`\n        comment += `\\`${targetStepResult.name}\\` was not found in the workflow steps.\\n\\n`\n      }\n    } else if (targetStepResult.conclusion === 'success') {\n      // Success case - show stdout/stderr if available (pass stream getters)\n      const { formattedContent } = await formatOutput(\n        targetStepResult.outputs\n          ? () => targetStepResult.outputs!.getStdoutStream()\n          : undefined,\n        targetStepResult.outputs\n          ? () => targetStepResult.outputs!.getStderrStream()\n          : undefined,\n        MAX_OUTPUT_PER_STEP\n      )\n\n      if (!formattedContent) {\n        comment += `> [!NOTE]\\n> Completed successfully with no output.\\n\\n`\n      } else {\n        comment += formattedContent\n      }\n    } else {\n      // Target step failed or has other status\n      comment += `**Status:** ${targetStepResult.conclusion}\\n`\n\n      const exitCode = targetStepResult.outputs?.getExitCode()\n      if (exitCode) {\n        comment += `**Exit Code:** ${exitCode}\\n`\n      }\n\n      comment += '\\n'\n\n      const { formattedContent } = await formatOutput(\n        targetStepResult.outputs\n          ? () => targetStepResult.outputs!.getStdoutStream()\n          : undefined,\n        targetStepResult.outputs\n          ? () => targetStepResult.outputs!.getStderrStream()\n          : undefined,\n        MAX_OUTPUT_PER_STEP\n      )\n\n      if (!formattedContent) {\n        comment += `> [!NOTE]\\n> Failed with no output.\\n\\n`\n      } else {\n        comment += formattedContent\n      }\n    }\n  } else {\n    // Normal mode - show all failed steps or success summary\n    if (success) {\n      // Check if all steps were skipped\n      if (skippedSteps === totalSteps) {\n        comment += `All ${totalSteps} step(s) were skipped.\\n`\n      } else {\n        // Generate summary based on step counts\n        const parts: string[] = []\n        if (successfulSteps > 0) {\n          parts.push(`${successfulSteps} succeeded`)\n        }\n        if (skippedSteps > 0) {\n          parts.push(`${skippedSteps} skipped`)\n        }\n\n        if (parts.length > 0) {\n          comment += `${parts.join(', ')} (${totalSteps} total)\\n`\n        } else {\n          comment += `${totalSteps} step(s) completed\\n`\n        }\n      }\n    } else {\n      // Focus on failures\n      comment += `${failedSteps.length} of ${totalSteps} step(s) failed:\\n\\n`\n\n      for (const step of failedSteps) {\n        comment += `#### ‚ùå Step: \\`${step.name}\\`\\n\\n`\n        comment += `**Status:** ${step.conclusion}\\n`\n\n        const exitCode = step.outputs.getExitCode()\n        if (exitCode) {\n          comment += `**Exit Code:** ${exitCode}\\n`\n        }\n\n        comment += '\\n'\n\n        const { formattedContent } = await formatOutput(\n          () => step.outputs.getStdoutStream(),\n          () => step.outputs.getStderrStream(),\n          MAX_OUTPUT_PER_STEP\n        )\n\n        if (!formattedContent) {\n          comment += `> [!NOTE]\\n> Failed with no output.\\n\\n`\n        } else {\n          comment += formattedContent\n        }\n      }\n    }\n  }\n\n  // Add footer with logs link and optional timestamp\n  if (includeLogLink) {\n    const logUrl = getJobLogsUrl()\n    const formattedTime = timestamp ? formatTimestamp(timestamp) : ''\n\n    comment += `\\n---\\n\\n`\n\n    if (logUrl) {\n      comment += `[View logs](${logUrl})`\n    }\n\n    if (formattedTime) {\n      if (logUrl) {\n        comment += ` ‚Ä¢ `\n      }\n      comment += `Last updated: ${formattedTime}`\n    }\n\n    comment += `\\n`\n  }\n\n  // Final safety check\n  if (comment.length > MAX_COMMENT_SIZE) {\n    const availableSpace = MAX_COMMENT_SIZE - COMMENT_TRUNCATION_BUFFER\n    comment =\n      comment.substring(0, availableSpace) + '\\n\\n... [comment truncated] ...\\n'\n  }\n\n  return comment\n}\n\nexport function getWorkspaceMarker(workspace: string): string {\n  // Escape characters that could break HTML comments or search queries\n  // Replace: double quotes, HTML comment end sequences (both --> and --!>), and backslashes\n  const escapedWorkspace = workspace\n    .replace(/\\\\/g, '\\\\\\\\') // Escape backslashes first\n    .replace(/\"/g, '\\\\\"') // Escape double quotes\n    .replace(/--[!>]/g, (match) => `--\\\\${match.charAt(2)}`) // Escape HTML comment end sequences\n  return `<!-- tf-report-action:\"${escapedWorkspace}\" -->`\n}\n\n/**\n * Generate title for PR comments (dynamic with status icons)\n */\nexport function generateTitle(\n  workspace: string,\n  analysis: AnalysisResult\n): string {\n  const { success, targetStepResult } = analysis\n  let statusIcon = ''\n  let statusText = ''\n\n  if (targetStepResult) {\n    // Target step mode\n    // Show as failure if target step didn't run or overall workflow failed\n    const showAsFailure = !targetStepResult.found || !success\n\n    // Check for \"No Changes\" case for successful plan with no changes\n    if (\n      !showAsFailure &&\n      targetStepResult.isJsonLines &&\n      targetStepResult.operationType === 'plan' &&\n      !targetStepResult.hasChanges &&\n      !targetStepResult.hasErrors\n    ) {\n      statusIcon = '‚úÖ'\n      statusText = 'No Changes'\n      return `${statusIcon} \\`${workspace}\\` \\`${targetStepResult.name}\\` ${statusText}`\n    }\n\n    // For successful plan/apply with changes, use the change summary\n    if (\n      !showAsFailure &&\n      targetStepResult.isJsonLines &&\n      targetStepResult.changeSummaryMessage &&\n      (targetStepResult.operationType === 'plan' ||\n        targetStepResult.operationType === 'apply')\n    ) {\n      statusIcon = '‚úÖ'\n      // Strip the prefix from the change summary message\n      let summary = targetStepResult.changeSummaryMessage\n      if (summary.startsWith('Plan: ')) {\n        summary = summary.substring('Plan: '.length)\n      } else if (summary.startsWith('Apply complete! Resources: ')) {\n        summary = summary.substring('Apply complete! Resources: '.length)\n      }\n      // Remove trailing period if present\n      if (summary.endsWith('.')) {\n        summary = summary.slice(0, -1)\n      }\n      return `${statusIcon} \\`${workspace}\\` \\`${targetStepResult.name}\\`: ${summary}`\n    }\n\n    statusIcon = showAsFailure ? '‚ùå' : '‚úÖ'\n    statusText = showAsFailure ? 'Failed' : 'Succeeded'\n    return `${statusIcon} \\`${workspace}\\` \\`${targetStepResult.name}\\` ${statusText}`\n  } else {\n    // Normal mode\n    statusIcon = success ? '‚úÖ' : '‚ùå'\n    statusText = success ? 'Succeeded' : 'Failed'\n    return `${statusIcon} \\`${workspace}\\` ${statusText}`\n  }\n}\n\n/**\n * Generate static title for status issues (fixed format)\n */\nexport function generateStatusIssueTitle(workspace: string): string {\n  return `:bar_chart: \\`${workspace}\\` Status`\n}\n\n/**\n * Format output from streams, detecting and handling JSON Lines format.\n * Limits based on formatted output size.\n */\nasync function formatOutput(\n  getStdoutStream: (() => Readable | undefined) | undefined,\n  getStderrStream: (() => Readable | undefined) | undefined,\n  maxSize: number = MAX_OUTPUT_PER_STEP\n): Promise<{ formattedContent: string; isJsonLines: boolean }> {\n  // Check if stdout is JSON Lines format (with fresh stream for detection)\n  if (getStdoutStream) {\n    const detectionStream = getStdoutStream()\n    const isJsonLinesFormat = await isJsonLines(detectionStream)\n\n    if (isJsonLinesFormat) {\n      // Get a fresh stream for formatting\n      const formattingStream = getStdoutStream()\n      const formatted = await formatJsonLines(formattingStream, maxSize)\n\n      if (formatted.trim().length > 0) {\n        return { formattedContent: formatted, isJsonLines: true }\n      }\n    }\n  }\n\n  // Fall back to standard output formatting with limited reading\n  let content = ''\n\n  if (getStdoutStream) {\n    const stdoutStream = getStdoutStream()\n    const stdout = await readLimitedStreamContent(stdoutStream, maxSize)\n    if (stdout && stdout.trim().length > 0) {\n      const truncated = truncateOutput(stdout, maxSize, true)\n      content += `<details>\\n<summary>üìÑ Output</summary>\\n\\n\\`\\`\\`\\n${truncated}\\n\\`\\`\\`\\n</details>\\n\\n`\n    }\n  }\n\n  if (getStderrStream) {\n    const stderrStream = getStderrStream()\n    const stderr = await readLimitedStreamContent(stderrStream, maxSize)\n    if (stderr && stderr.trim().length > 0) {\n      const truncated = truncateOutput(stderr, maxSize, true)\n      content += `<details>\\n<summary>‚ö†Ô∏è Errors</summary>\\n\\n\\`\\`\\`\\n${truncated}\\n\\`\\`\\`\\n</details>\\n\\n`\n    }\n  }\n\n  if (!content) {\n    return { formattedContent: '', isJsonLines: false }\n  }\n\n  return { formattedContent: content, isJsonLines: false }\n}\n\nasync function run(): Promise<void> {\n  try {\n    const stepsInput = getInput('steps')\n    let workspace = getInput('workspace')\n    const targetStep = getInput('target-step')\n\n    if (!stepsInput) {\n      setFailed('steps input is required')\n      return\n    }\n\n    // If workspace is not provided, use workflow name and job name\n    if (!workspace) {\n      const workflowName = process.env.GITHUB_WORKFLOW || 'Workflow'\n      const jobName = process.env.GITHUB_JOB || 'Job'\n      workspace = `${workflowName}/${jobName}`\n      info(`No workspace provided, using: \\`${workspace}\\``)\n    }\n\n    let steps: Steps\n    try {\n      steps = JSON.parse(stepsInput)\n    } catch (error) {\n      setFailed(\n        `Failed to parse steps input as JSON: ${error instanceof Error ? error.message : 'Unknown error'}`\n      )\n      return\n    }\n\n    info(\n      `Analyzing ${Object.keys(steps).length} steps for workspace: \\`${workspace}\\`${targetStep ? ` (target: \\`${targetStep}\\`)` : ''}`\n    )\n\n    const analysis = await analyzeSteps(steps, targetStep)\n\n    info(\n      `Analysis complete: ${analysis.success ? 'Success' : `Failed (${analysis.failedSteps.length} failures)`}`\n    )\n\n    const context = {\n      repo: process.env.GITHUB_REPOSITORY || '',\n      eventName: process.env.GITHUB_EVENT_NAME || ''\n    }\n\n    if (!context.repo) {\n      info('GITHUB_REPOSITORY not set, skipping comment/issue')\n      return\n    }\n\n    const repoParts = context.repo.split('/')\n    if (repoParts.length !== 2) {\n      info(\n        `Invalid GITHUB_REPOSITORY format: ${context.repo}, skipping comment/issue`\n      )\n      return\n    }\n\n    const [owner, repo] = repoParts\n\n    const token = getInput('github-token')\n    if (!token) {\n      setFailed(\n        'github-token input is required to post comments/issues. Use: github-token: ${{ github.token }}'\n      )\n      return\n    }\n\n    const marker = getWorkspaceMarker(workspace)\n\n    info(`Comment/Issue body length calculation in progress...`)\n\n    let issueNumber: number | undefined\n\n    // Check if this is a pull request event\n    if (\n      context.eventName === 'pull_request' ||\n      context.eventName === 'pull_request_target'\n    ) {\n      const eventPath = process.env.GITHUB_EVENT_PATH\n      if (eventPath) {\n        try {\n          const event = JSON.parse(fs.readFileSync(eventPath, 'utf8'))\n          issueNumber = event.pull_request?.number\n        } catch (error) {\n          info(\n            `Failed to read GitHub event file: ${error instanceof Error ? error.message : 'Unknown error'}`\n          )\n        }\n      }\n    }\n\n    if (issueNumber) {\n      // PR context: post as comment\n      // Include log link when there are changes planned or applied\n      const hasChanges =\n        analysis.targetStepResult?.hasChanges ||\n        analysis.targetStepResult?.operationType === 'apply'\n      const includeLogLink = !!hasChanges\n\n      info(\n        `Running in PR context - posting as comment${includeLogLink ? ' with logs link' : ''}`\n      )\n\n      const commentBody = await generateCommentBody(\n        workspace,\n        analysis,\n        includeLogLink\n      )\n\n      info(`Comment body length: ${commentBody.length} characters`)\n\n      const existingComments = await getExistingComments(\n        token,\n        repo,\n        owner,\n        issueNumber\n      )\n\n      for (const comment of existingComments) {\n        if (comment.body && comment.body.includes(marker)) {\n          info(`Deleting previous comment for workspace: \\`${workspace}\\``)\n          await deleteComment(token, repo, owner, comment.id)\n        }\n      }\n\n      info(`Posting new comment for workspace: \\`${workspace}\\``)\n      await postComment(token, repo, owner, issueNumber, commentBody)\n\n      info('Comment posted successfully')\n    } else {\n      // Non-PR context: use status issue (include log link and timestamp)\n      info('Not in PR context - using status issue')\n\n      const timestamp = new Date()\n      const statusIssueBody = await generateCommentBody(\n        workspace,\n        analysis,\n        true,\n        timestamp\n      )\n      const statusIssueTitle = generateStatusIssueTitle(workspace)\n\n      info(`Status issue title: \"${statusIssueTitle}\"`)\n      info(`Status issue body length: ${statusIssueBody.length} characters`)\n\n      // Search for existing status issue with the marker in body\n      const query = `repo:${owner}/${repo} is:issue in:body \"${marker}\"`\n      const existingIssues = await searchIssues(token, repo, owner, query)\n\n      let statusIssueNumber: number | undefined\n\n      // Find the issue that matches our workspace marker\n      for (const issue of existingIssues) {\n        if (issue.body && issue.body.includes(marker)) {\n          statusIssueNumber = issue.number\n          info(\n            `Found existing status issue #${statusIssueNumber} for workspace: \\`${workspace}\\``\n          )\n          break\n        }\n      }\n\n      if (statusIssueNumber) {\n        // Update existing issue\n        info(`Updating status issue #${statusIssueNumber}`)\n        await updateIssue(\n          token,\n          repo,\n          owner,\n          statusIssueNumber,\n          statusIssueTitle,\n          statusIssueBody\n        )\n        info('Status issue updated successfully')\n      } else {\n        // Create new issue\n        info(`Creating new status issue for workspace: \\`${workspace}\\``)\n        statusIssueNumber = await createIssue(\n          token,\n          repo,\n          owner,\n          statusIssueTitle,\n          statusIssueBody\n        )\n        info(`Status issue #${statusIssueNumber} created successfully`)\n      }\n    }\n  } catch (error) {\n    if (error instanceof Error) {\n      setFailed(error.message)\n    } else {\n      setFailed('An unknown error occurred')\n    }\n  }\n}\n\n// Run the action if this is the main module\nif (\n  import.meta.url === `file://${process.argv[1]}` ||\n  import.meta.url.endsWith(process.argv[1])\n) {\n  run()\n}\n"],"names":[],"mappings":"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"}